<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mr. Kin&#39;s Blog</title>
  <icon>https://mister-kin.github.io/images-public/favicon/logo.svg</icon>
  <subtitle>计算机知识分享/软件应用讲解</subtitle>
  <link href="https://mister-kin.github.io/atom.xml" rel="self"/>
  
  <link href="https://mister-kin.github.io/"/>
  <updated>2025-10-31T17:11:00.000Z</updated>
  <id>https://mister-kin.github.io/</id>
  
  <author>
    <name>Mr. Kin</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PVE虚拟化系统升级小记（8.x-&gt;9.x）</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/pve8to9/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/pve8to9/</id>
    <published>2025-10-31T13:03:42.000Z</published>
    <updated>2025-10-31T17:11:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">1 &nbsp&nbsp<a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>企业软件开发商<code>Proxmox Server Solutions GmbH</code>在2025年8月5日发布了<code>Proxmox VE</code>9.0版本，这两天终于得空给家里的HomeLab机器操作升级，因此记录一下从PVE 8.x升级到PVE 9.x步骤。</p><p>为了方便软件包下载，一般需要将linux系统的替换成国内镜像源。这样操作更新时，系统访问的是国内镜像服务器，网络速率就不会受限于每秒几十KB。以下内容替换使用的镜像源均为中科大源。</p><h1 id="升级到PVE-8-x最新的版本">2 &nbsp&nbsp<a href="#升级到PVE-8-x最新的版本" class="headerlink" title="升级到PVE 8.x最新的版本"></a>升级到PVE 8.x最新的版本</h1><p><strong>一般更新操作，都是推荐替换国内镜像源再操作。由于本文主要阐述升级步骤，这里不再赘述如何替换PVE 8.x版本系统的软件源，如想了解可参阅我的博客。</strong></p><p>输入如下命令完成升级并查看当前PVE版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update -y &amp;&amp; apt dist-upgrade -y</span><br><span class="line">pveversion</span><br></pre></td></tr></table></figure><div class="flex-row"><div class="flex-column"><img data-src="/images/software/pve/pve8x-update-to-lateset.webp">执行apt命令升级</div><div class="flex-column"><img data-src="/images/software/pve/pve8x-lastest-check-version.webp">pveversion查看当前版本</div></div><h1 id="检查版本升级的兼容性">3 &nbsp&nbsp<a href="#检查版本升级的兼容性" class="headerlink" title="检查版本升级的兼容性"></a>检查版本升级的兼容性</h1><p>输入如下命令调用升级检查脚本命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pve8to9</span><br></pre></td></tr></table></figure><p>笔者遇到两个警告WARN和一个失败FAIL。</p><p>警告1：提示有正在运行的客户端，检查程序推荐考虑迁移或者关闭。这个警告笔者是无视的，毕竟HomeLab的主路由和DNS递归查询等服务都是部署在这些虚拟机上，若是关闭，笔者还得额外调整网络参数才能联网。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARN: 9 running guest(s) detected - consider migrating or stopping them.</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/software/pve/pve8to9-warning1.webp">pve8to9警告信息1</div><p>警告2：提示本系统缺乏Intel微码，可无视该警告。想要消除警告，就使用命令安装微码<code>apt install intel-microcode</code>。AMD的CPU机器的微码安装命令为<code>apt install amd64-microcode</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARN: The matching CPU microcode package &#x27;intel-microcode&#x27; could not be found! Consider installing it to receive the latest security and bug fixes for your CPU.</span><br><span class="line">        Ensure you enable the &#x27;non-free-firmware&#x27; component in the apt sources and run:</span><br><span class="line">        apt install intel-microcode</span><br></pre></td></tr></table></figure><div class="flex-row"><div class="flex-column"><img data-src="/images/software/pve/pve8to9-warning2.webp">pve8to9警告信息2</div><div class="flex-column"><img data-src="/images/software/pve/apt-install-intel-microcode.webp">安装Intel处理器微码</div></div><p>失败：这是因为PVE 9.x版本是基于<code>Debian Trixie</code>版本开发的，这个版本中<code>systemd-boot</code>已经被拆分成三个包<code>systemd-boot-efi</code>、<code>systemd-boot-tools</code>和<code>systemd-boot</code>，因此检查脚本若提示要卸载移除，最好是移除它。解决方法是运行卸载命令<code>apt remove systemd-boot</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FAIL: systemd-boot meta-package installed. This will cause problems on upgrades of other boot-related packages. Remove &#x27;systemd-boot&#x27; See https://pve.proxmox.com/wiki/Upgrade_from_8_to_9#sd-boot-warning for more information.</span><br></pre></td></tr></table></figure><div class="flex-row"><div class="flex-column"><img data-src="/images/software/pve/pve8to9-fail.webp">pve8to9失败信息</div><div class="flex-column"><img data-src="/images/software/pve/apt-remove-systemd-boot.webp">移除systemd-boot</div></div><p>注意解在决警告和失败之后，请重新运行检查脚本程序<code>pve8to9</code>，检查没有问题则进行下一步替换PVE 9.x镜像源。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pve8to9</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/software/pve/rerun-pve8to9.webp">重新运行检查脚本程序pve8to9</div><h1 id="替换PVE-9-x的软件源">4 &nbsp&nbsp<a href="#替换PVE-9-x的软件源" class="headerlink" title="替换PVE 9.x的软件源"></a>替换PVE 9.x的软件源</h1><h2 id="替换Debian系统软件源">4.1 &nbsp&nbsp<a href="#替换Debian系统软件源" class="headerlink" title="替换Debian系统软件源"></a>替换Debian系统软件源</h2><p>修改&#x2F;etc&#x2F;apt&#x2F;sources.list文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">nano /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>使用如下内容覆盖文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deb http://ftp.debian.org/debian trixie main contrib</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ trixie main contrib non-free non-free-firmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># deb http://ftp.debian.org/debian trixie-updates main contrib</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ trixie-updates main contrib non-free non-free-firmware</span><br><span class="line"></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian/ trixie-backports main contrib non-free non-free-firmware</span><br><span class="line"><span class="comment"># security updates</span></span><br><span class="line"><span class="comment"># deb http://security.debian.org trixie-security main contrib</span></span><br><span class="line">deb https://mirrors.ustc.edu.cn/debian-security trixie-security main contrib non-free non-free-firmware</span><br></pre></td></tr></table></figure><h2 id="替换PVE软件源">4.2 &nbsp&nbsp<a href="#替换PVE软件源" class="headerlink" title="替换PVE软件源"></a>替换PVE软件源</h2><p>删除pve-enterprise.list，新建pve-no-subscription.list，参照如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/apt/sources.list.d/pve-enterprise.list /etc/apt/sources.list.d/pve-enterprise.list.bak</span><br><span class="line"><span class="built_in">echo</span> deb https://mirrors.ustc.edu.cn/proxmox/debian/pve trixie pve-no-subscription &gt; /etc/apt/sources.list.d/pve-no-subscription.list</span><br></pre></td></tr></table></figure><h2 id="替换CEPH分布式源">4.3 &nbsp&nbsp<a href="#替换CEPH分布式源" class="headerlink" title="替换CEPH分布式源"></a>替换CEPH分布式源</h2><p>修改<code>/etc/apt/sources.list.d/ceph.list</code>和<code>/usr/share/perl5/PVE/CLI/pveceph.pm</code>文件内容。<code>pveceph.pm</code>推荐是更新系统之后再操作，否则更新系统之后<code>pveceph.pm</code>会覆盖回默认的域名<code>http://download.proxmox.com</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/apt/sources.list.d/ceph.list /etc/apt/sources.list.d/ceph.list.bak</span><br><span class="line"><span class="built_in">echo</span> deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-squid trixie no-subscription &gt; /etc/apt/sources.list.d/ceph.list</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /usr/share/perl5/PVE/CLI/pveceph.pm /usr/share/perl5/PVE/CLI/pveceph.pm.bak</span><br><span class="line">sed -i <span class="string">&quot;s#http://download.proxmox.com#https://mirrors.ustc.edu.cn/proxmox#g&quot;</span> /usr/share/perl5/PVE/CLI/pveceph.pm</span><br></pre></td></tr></table></figure><h1 id="开始正式升级（8-4-9-x）">5 &nbsp&nbsp<a href="#开始正式升级（8-4-9-x）" class="headerlink" title="开始正式升级（8.4-&gt;9.x）"></a>开始正式升级（8.4-&gt;9.x）</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update -y &amp;&amp; apt dist-upgrade -y</span><br></pre></td></tr></table></figure><div class="note info no-icon"><p>升级若遇到提示<code>Upgrade wants to remove package &#39;proxmox-ve&#39;</code>的话，在升级前尝试执行<code>apt remove linux-image-amd64</code>。</p></div><p>升级中会出现一些交互界面，下面是官网的建议（不清楚的选项，可以选择推荐参数）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/etc/issue -&gt; Proxmox VE will auto-generate this file on boot, and it has only cosmetic effects on the login console.</span><br><span class="line">Using the default <span class="string">&quot;No&quot;</span> (keep your currently-installed version) is safe here.</span><br><span class="line"></span><br><span class="line">/etc/lvm/lvm.conf -&gt; Changes relevant <span class="keyword">for</span> Proxmox VE will be updated, and a newer config version might be useful.</span><br><span class="line">If you did not make extra changes yourself and are unsure it<span class="string">&#x27;s suggested to choose &quot;Yes&quot; (install the package maintainer&#x27;</span>s version) here.</span><br><span class="line"></span><br><span class="line">/etc/ssh/sshd_config -&gt; If you have not changed this file manually, the only differences should be a replacement of ChallengeResponseAuthentication no with KbdInteractiveAuthentication no and some irrelevant changes <span class="keyword">in</span> comments (lines starting with <span class="comment">#).</span></span><br><span class="line">If this is the <span class="keyword">case</span>, both options are safe, though we would recommend installing the package maintainer<span class="string">&#x27;s version in order to move away from the deprecated ChallengeResponseAuthentication option. If there are other changes, we suggest to inspect them closely and decide accordingly.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/etc/default/grub -&gt; Here you may want to take special care, as this is normally only asked for if you changed it manually, e.g., for adding some kernel command line option.</span></span><br><span class="line"><span class="string">It&#x27;</span>s recommended to check the difference <span class="keyword">for</span> any relevant change, note that changes <span class="keyword">in</span> comments (lines starting with <span class="comment">#) are not relevant.</span></span><br><span class="line">If unsure, we suggested to selected <span class="string">&quot;No&quot;</span> (keep your currently-installed version)</span><br><span class="line"></span><br><span class="line">/etc/chrony/chrony.conf -&gt; If you made <span class="built_in">local</span> changes you might want to move them out of the global config into the conf.d or, <span class="keyword">for</span> custom <span class="keyword">time</span> sources, the sources.d folder.</span><br><span class="line">See the /etc/chrony/conf.d/README and /etc/chrony/sources.d/README files on your system <span class="keyword">for</span> detaily.</span><br><span class="line">If you did not make extra changes yourself and are unsure it<span class="string">&#x27;s suggested to choose &quot;Yes&quot; (install the package maintainer&#x27;</span>s version) here.</span><br></pre></td></tr></table></figure><p>以下是实操选择的参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Configuration file <span class="string">&#x27;/etc/issue&#x27;</span></span><br><span class="line"> ==&gt; Modified (by you or by a script) since installation.</span><br><span class="line"> ==&gt; Package distributor has shipped an updated version.</span><br><span class="line">   What would you like to <span class="keyword">do</span> about it ?  Your options are:</span><br><span class="line">    Y or I  : install the package maintainer<span class="string">&#x27;s version</span></span><br><span class="line"><span class="string">    N or O  : keep your currently-installed version</span></span><br><span class="line"><span class="string">      D     : show the differences between the versions</span></span><br><span class="line"><span class="string">      Z     : start a shell to examine the situation</span></span><br><span class="line"><span class="string"> The default action is to keep your current version.</span></span><br><span class="line"><span class="string">*** issue (Y/I/N/O/D/Z) [default=N] ?</span></span><br><span class="line"><span class="string">输入N回车</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Configuring libc6:amd64 ├────────────────────────────────────────────┐</span></span><br><span class="line"><span class="string"> │                                                                                                                   │</span></span><br><span class="line"><span class="string"> │ There are services installed on your system which need to be restarted when certain libraries, such as libpam,    │</span></span><br><span class="line"><span class="string"> │ libc, and libssl, are upgraded. Since these restarts may cause interruptions of service for the system, you will  │</span></span><br><span class="line"><span class="string"> │ normally be prompted on each upgrade for the list of services you wish to restart.  You can choose this option    │</span></span><br><span class="line"><span class="string"> │ to avoid being prompted; instead, all necessary restarts will be done for you automatically so you can avoid      │</span></span><br><span class="line"><span class="string"> │ being asked questions on each library upgrade.                                                                    │</span></span><br><span class="line"><span class="string"> │                                                                                                                   │</span></span><br><span class="line"><span class="string"> │ Restart services during package upgrades without asking?                                                          │</span></span><br><span class="line"><span class="string"> │                                                                                                                   │</span></span><br><span class="line"><span class="string"> │                                  &lt;Yes&gt;                                     &lt;No&gt;                                   │</span></span><br><span class="line"><span class="string"> │                                                                                                                   │</span></span><br><span class="line"><span class="string"> └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span></span><br><span class="line"><span class="string">选择Yes回车</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Configuration file &#x27;</span>/etc/lvm/lvm.conf<span class="string">&#x27;</span></span><br><span class="line"><span class="string"> ==&gt; Modified (by you or by a script) since installation.</span></span><br><span class="line"><span class="string"> ==&gt; Package distributor has shipped an updated version.</span></span><br><span class="line"><span class="string">   What would you like to do about it ?  Your options are:</span></span><br><span class="line"><span class="string">    Y or I  : install the package maintainer&#x27;</span>s version</span><br><span class="line">    N or O  : keep your currently-installed version</span><br><span class="line">      D     : show the differences between the versions</span><br><span class="line">      Z     : start a shell to examine the situation</span><br><span class="line"> The default action is to keep your current version.</span><br><span class="line">*** lvm.conf (Y/I/N/O/D/Z) [default=N] ?</span><br><span class="line">输入Y回车</span><br></pre></td></tr></table></figure><h1 id="屏蔽PVE-9-x企业源pve-enterprise-sources">6 &nbsp&nbsp<a href="#屏蔽PVE-9-x企业源pve-enterprise-sources" class="headerlink" title="屏蔽PVE 9.x企业源pve-enterprise.sources"></a>屏蔽PVE 9.x企业源<code>pve-enterprise.sources</code></h1><p>成功升级至PVE 9.x之后，会自动生成一个<code>DEB822</code>格式的企业源<code>pve-enterprise.sources</code>文件，需要手动屏蔽它，否则WEB后台和<code>apt update</code>会有提示。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/apt/sources.list.d/pve-enterprise.sources /etc/apt/sources.list.d/pve-enterprise.sources.bak</span><br><span class="line">apt update -y</span><br></pre></td></tr></table></figure><h1 id="移除无用的包">7 &nbsp&nbsp<a href="#移除无用的包" class="headerlink" title="移除无用的包"></a>移除无用的包</h1><p>运行如下如下命令，移除无用的包，节省服务器空间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt autoremove</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/software/pve/apt-auto-remove.webp">移除无用的包</div><h1 id="替换LXC模板（CT-Templates）镜像源">8 &nbsp&nbsp<a href="#替换LXC模板（CT-Templates）镜像源" class="headerlink" title="替换LXC模板（CT Templates）镜像源"></a>替换LXC模板（CT Templates）镜像源</h1><p>修改<code>/usr/share/perl5/PVE/APLInfo.pm</code>文件内容，<strong>针对 <code>/usr/share/perl5/PVE/APLInfo.pm</code> 文件的修改，执行<code>systemctl restart pvedaemon</code>后生效。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm.bak</span><br><span class="line">sed -i <span class="string">&quot;s#http://download.proxmox.com/images#https://mirrors.ustc.edu.cn/proxmox/images#g&quot;</span> /usr/share/perl5/PVE/APLInfo.pm</span><br></pre></td></tr></table></figure><h1 id="去除PVE未订阅提示">9 &nbsp&nbsp<a href="#去除PVE未订阅提示" class="headerlink" title="去除PVE未订阅提示"></a>去除PVE未订阅提示</h1><p><strong>完成如下文件内容修改后，注销浏览器当前的PVE登录信息，并重新登录就没有提示弹窗了。实测PVE 9.x版本执行该方法之后，WEB后台的「软件包版本」按钮无法响应，暂未排查到问题，后面有时间再跟进。</strong></p><ul><li><code>/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js.bak</span><br><span class="line">sed -i <span class="string">&quot;s/if (res === null || res === undefined || \!res || res/if(/g&quot;</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js</span><br><span class="line">sed -i <span class="string">&quot;s/.data.status.toLowerCase() !== &#x27;active&#x27;/false/g&quot;</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js</span><br><span class="line">systemctl restart pveproxy</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/software/pve/pve-no-subscribe.webp">「无有效订阅」的提示弹窗</div><h1 id="后续PVE系统日常更新：">10 &nbsp&nbsp<a href="#后续PVE系统日常更新：" class="headerlink" title="后续PVE系统日常更新："></a>后续PVE系统日常更新：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update -y &amp;&amp; apt dist-upgrade -y</span><br></pre></td></tr></table></figure><h1 id="后记">11 &nbsp&nbsp<a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>以下就是升级到最新的PVE 9.x版本的WEB后台界面了。</p><div class="flex-column"><img data-src="/images/software/pve/pve9x-web-control.webp">PVE 9.x的WEB后台界面</div><h1 id="参考文献">12 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] Upgrade from 8 to 9[EB&#x2F;OL]. <a href="https://pve.proxmox.com/wiki/Upgrade_from_8_to_9">https://pve.proxmox.com/wiki/Upgrade_from_8_to_9</a>.<br>[2] Proxmox[EB&#x2F;OL]. <a href="https://mirrors.ustc.edu.cn/help/proxmox.html">https://mirrors.ustc.edu.cn/help/proxmox.html</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;企业软件开发商&lt;code&gt;Proxmox Server Solutions</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="PVE" scheme="https://mister-kin.github.io/tags/PVE/"/>
    
    <category term="升级" scheme="https://mister-kin.github.io/tags/%E5%8D%87%E7%BA%A7/"/>
    
    <category term="Proxmox" scheme="https://mister-kin.github.io/tags/Proxmox/"/>
    
    <category term="HomeLab" scheme="https://mister-kin.github.io/tags/HomeLab/"/>
    
    <category term="服务器" scheme="https://mister-kin.github.io/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="虚拟化系统" scheme="https://mister-kin.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>飞牛fnOS影视刮削的文件命名技巧</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/video-scraping-renaming-for-fnos/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/video-scraping-renaming-for-fnos/</id>
    <published>2025-10-29T13:46:47.000Z</published>
    <updated>2025-10-30T08:52:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">1 &nbsp&nbsp<a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>使用飞牛影视有一段日子了，整体感觉上还行，数据刮削算是比较省心，今天抽空来聊聊我在这方面的经验。</p><h1 id="一般的影视刮削的文件命名规则">2 &nbsp&nbsp<a href="#一般的影视刮削的文件命名规则" class="headerlink" title="一般的影视刮削的文件命名规则"></a>一般的影视刮削的文件命名规则</h1><p><strong>以下规则不仅适用于飞牛影视，同样可应用于Emby、Jellyfin等媒体系统工具。</strong></p><h2 id="电影类型">2.1 &nbsp&nbsp<a href="#电影类型" class="headerlink" title="电影类型"></a>电影类型</h2><p>一般电影本身就是单个文件，文件命名规则：影视名称+年份。像这样保留原有的电影名称和对应年份时，即使遇到同名的电影，刮削上基本不会出现问题。示例：<code>星际穿越Interstellar.2014.mkv</code>。</p><h2 id="动漫番剧和电视剧类型">2.2 &nbsp&nbsp<a href="#动漫番剧和电视剧类型" class="headerlink" title="动漫番剧和电视剧类型"></a>动漫番剧和电视剧类型</h2><p>动漫番剧和电视剧，这种可能存在多季多集的情况，推荐按<code>季</code>分别创建一个文件夹存放每一季的文件。文件命名规则：影视名称+对应的每季每集。示例<code>夏目友人帐.S01.E01.mkv</code>或者<code>夏目友人帐.S01E01.mkv</code>。父文件夹命名为：<code>夏目友人帐.S01</code>。</p><p>我个人是喜欢使用<code>.</code>符号作为分隔符，方便快速阅览辨识。</p><h2 id="动漫番剧的特别篇">2.3 &nbsp&nbsp<a href="#动漫番剧的特别篇" class="headerlink" title="动漫番剧的特别篇"></a>动漫番剧的特别篇</h2><p>特别篇比较特殊，大部分情况可能需要人工校正刮削的数据。</p><p>目前我是将<code>SP</code>、<code>OVA</code>、<code>OAD</code>这些全都归入为特别篇类型，然后根据<code>季</code>的数量来判断使用不同的命名规则。为什么这样处理呢？因为飞牛影视的手动匹配逻辑，特别篇就只能输入<code>0</code>作为一个季。而多季多集的特别篇就不适用于这种逻辑。</p><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/manual-scraping.webp">手动刮削匹配界面-影视匹配</div><h3 id="特别篇只有一季的情况">2.3.1 &nbsp&nbsp<a href="#特别篇只有一季的情况" class="headerlink" title="特别篇只有一季的情况"></a>特别篇只有一季的情况</h3><p>只有一季时，命名时就无需带入<code>季</code>的编号，只保留番剧名称和特别篇标识缩写即可，示例：<code>紫罗兰永恒花园.OVA.mp4</code>或者<code>紫罗兰永恒花园.OVA.一定会理解「爱」的真谛.mp4</code>。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/voilet.webp">紫罗兰永恒花园-刮削效果</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/voilet-details.webp">紫罗兰永恒花园-特别篇详情</div></div><h3 id="特别篇有多季的情况">2.3.2 &nbsp&nbsp<a href="#特别篇有多季的情况" class="headerlink" title="特别篇有多季的情况"></a>特别篇有多季的情况</h3><p>因为我个人喜欢按季存放对应的特别篇文件，每季的特别篇的文件集数编号都是按最后一集顺延+1编号，例如夏目友人帐第五季的特别篇，示例命名：<code>夏目友人帐.S05.E12.OVA1.mkv</code>。</p><p>其实IMDB网站上的数据，特别篇也是按最后一集顺延+1编号。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/natsume.webp">夏目友人帐第五季-刮削效果</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/natsume-details.webp">夏目友人帐第五季-特别篇1详情</div></div><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/natsume-imdb.webp">IMDB网站数据-夏目友人帐第五季</div><h2 id="外挂字幕文件类型">2.4 &nbsp&nbsp<a href="#外挂字幕文件类型" class="headerlink" title="外挂字幕文件类型"></a>外挂字幕文件类型</h2><p>文件命名规则：字幕文件名保持与视频文件同名，最后加上分隔符和字幕语言类型。以下简单介绍几种语言类型：</p><ul><li>简体中文：推荐<code>chs</code>，不推荐<code>sc</code>，可能被识别成撒丁语，示例：<code>夏目友人帐.S01.E01.chs.ass</code></li><li>繁体中文：推荐<code>cht</code>，不推荐<code>tc</code>，可能被识别成und，示例：<code>夏目友人帐.S01.E01.cht.ass</code></li><li>日文：推荐<code>jap</code>，示例：<code>夏目友人帐.S01.E01.jap.ass</code></li><li>简中日文双语：示例：<code>夏目友人帐.S01.E01.chs&amp;jap.ass</code></li></ul><h1 id="批量重命名工具：PowerRename">3 &nbsp&nbsp<a href="#批量重命名工具：PowerRename" class="headerlink" title="批量重命名工具：PowerRename"></a>批量重命名工具：PowerRename</h1><p>文件管理少不了文件重命名，这里推荐一个工具<code>PowerRename</code>，该工具支持正则表达式。该工具是<code>PowerToys</code>的内置工具，仅适用于Windows平台。</p><p>安装方法：</p><ol><li>打开Windows系统的微软商店。</li><li>搜索安装<code>PowerToys</code></li><li>打开<code>PowerToys</code>界面并确保启用<code>PowerRename</code>，这样Windows中的右键菜单上下文就出现<code>PowerRename</code>选项了。</li></ol><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/powertoys.webp">微软商店界面-PowerToys</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/powertoys-enable-powerrename.webp">PowerToys启用PowerRename</div></div><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/right-click-menu.webp">右键菜单-PowerRename</div><h1 id="PowerRename的命名规则">4 &nbsp&nbsp<a href="#PowerRename的命名规则" class="headerlink" title="PowerRename的命名规则"></a>PowerRename的命名规则</h1><p>示例编码：<code>夏目友人帐.S05.E$&#123;increment=1,padding=2,start=1&#125;</code>，示例图片中的<code>.*</code>是正则表达式，代表匹配所有任意字符。</p><p>这里简单介绍自动编号的规则：<code>$&#123;&#125;</code>是属于高级计数器语法，<code>increment=1</code>代表每次增长1；<code>padding=2</code>代表自动使用前导零数填充为两位，例如数字1自动填充为<code>01</code>，当增长超过两位数时，例如三位数则不受限于该规则；<code>start=1</code>代表从1开始。</p><p>PowerRename的详细使用方法和语法规则可参阅：<a href="https://learn.microsoft.com/zh-cn/windows/powertoys/powerrename">PowerRename 实用工具 Windows</a></p><div class="flex-column"><img data-src="/images/post-articles/2025-10/video-scraping-renaming-for-fnos/powerraname.webp">PowerRename示例编码</div><h1 id="内容延伸：影视文件常见命名缩写含义">5 &nbsp&nbsp<a href="#内容延伸：影视文件常见命名缩写含义" class="headerlink" title="内容延伸：影视文件常见命名缩写含义"></a>内容延伸：影视文件常见命名缩写含义</h1><ul><li>S1: season1, 第一季</li><li>E1&#x2F;EP1: episode1, 第一集</li><li>SP: special, 特别篇</li><li>OVA: Original Video Animation, 原创动画录影带</li><li>OAD: Original Animation Disc, 原创动画光碟</li><li>OST: Original Soundtrack, 影视原声集</li><li>HD: Hign Definition, 高清</li><li>BD: Blu-ray Disc, 蓝光</li><li>X264&#x2F;HEVC: h264&#x2F;h265视频编码</li><li>AAC: 音频编码</li><li>CHS&#x2F;CHT&#x2F;JAP: 简体中文&#x2F;繁体中文字幕&#x2F;日文字幕</li><li>Director’s Cut: 导演剪辑版</li><li>On Air: TV版（电视节目或者动画播出时的版本）</li><li>Unrated: 未分级版</li><li>Extended: 加长版</li></ul><h1 id="参考文献">6 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] 万剑归宗之刮削大法！史上最全从Emby命名规则到刮削设置一条龙图文教程！[EB&#x2F;OL]. <a href="https://post.smzdm.com/p/aox8wp36/">https://post.smzdm.com/p/aox8wp36/</a>.<br>[2] 电影电视剧动漫 标准命名规则，jellfin、emby、kodi都适用[EB&#x2F;OL]. <a href="https://www.shejibiji.com/archives/8295">https://www.shejibiji.com/archives/8295</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;使用飞牛影视有一段日子了，整体感觉上还行，数据刮削算是比较省心，今天抽空来聊聊我在这方面的经验。&lt;/p&gt;
&lt;h1</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="fnOS" scheme="https://mister-kin.github.io/tags/fnOS/"/>
    
    <category term="飞牛" scheme="https://mister-kin.github.io/tags/%E9%A3%9E%E7%89%9B/"/>
    
    <category term="影视刮削" scheme="https://mister-kin.github.io/tags/%E5%BD%B1%E8%A7%86%E5%88%AE%E5%89%8A/"/>
    
    <category term="命名规则" scheme="https://mister-kin.github.io/tags/%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99/"/>
    
    <category term="技巧" scheme="https://mister-kin.github.io/tags/%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>USB千兆网卡评测-Airsky USB-C/USB-A外置网卡</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/</id>
    <published>2025-10-27T15:14:58.000Z</published>
    <updated>2025-10-27T18:41:26.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">1 &nbsp&nbsp<a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前段时间从某宝上淘了一个USB外置网卡（USB C&#x2F;USB A二合一接口），整体使用体验还行，因此抽空写一下评测。</p><h1 id="产品包装">2 &nbsp&nbsp<a href="#产品包装" class="headerlink" title="产品包装"></a>产品包装</h1><p>外包装盒子比较简单，全英文描述。Made in China，中国生产，但商品编码是非国内常见69码，我推测这个商品原计划是用于出口的，不知道为啥在某宝上流通这个商品。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/packaging-box-front.webp">包装盒正面</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/packaging-box-back.webp">包装盒背面</div></div><h1 id="产品外观">3 &nbsp&nbsp<a href="#产品外观" class="headerlink" title="产品外观"></a>产品外观</h1><p>该网卡总共有3个接口：RJ45接口+USB-C (Type-C)接口+USB-A接口。RJ45接口另一头默认是USB-C接口，该接口可以作为中间接口，拼接USB-A接口，即二合一。</p><p>USB-C (Type-C)接口和USB-A接口，塑料外壳设计上就是相连起来，这点好评。如果是分离接口设计的话，日常使用过程中可能会丢失。</p><p>产品中间线长大约为12厘米，二合一拼接起来产品全长约为21.5厘米。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/product.webp">产品外观</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/product-length.webp">产品长度</div></div><h1 id="网卡芯片">4 &nbsp&nbsp<a href="#网卡芯片" class="headerlink" title="网卡芯片"></a>网卡芯片</h1><p>将网卡接入Windows系统中，通过设备管理器可以查询到硬件ID为<code>USB\VID_0BDA&amp;PID_8153&amp;REV_3100</code>。通过硬件ID网站查询可知，该网卡内置芯片为瑞昱Realtek的RTL8153芯片。</p><p>在瑞昱Realtek官网查询可知，该芯片是一个千兆以太网适配器，可以自适应协商速率<code>10/100/1000M</code>。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/hardware-id.webp">硬件ID</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/hardware-id-result.webp">硬件ID查询结果</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/realtek-website.webp">realtek网站说明</div></div><h1 id="测试性能">5 &nbsp&nbsp<a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h1><h2 id="Windows平台测试">5.1 &nbsp&nbsp<a href="#Windows平台测试" class="headerlink" title="Windows平台测试"></a>Windows平台测试</h2><p>测试平台：</p><ul><li>Windows 11 Pro 25H2：26200.6901</li><li>iperf3：3.19.1</li></ul><p>Windows中使用<code>iperf3</code>工具测试局域网速率，分别对USB-C接口和USB-A接口进行测试，结果一致为<code>950Mbps</code>，可见转接使用USB-A接口时也不会影响速率。考虑网络传输的开销（例如IP头部信息，TCP头部信息等），<code>950Mbps</code>算是发挥了RTL8153芯片原有的性能。</p><p>其他配置项目跟普通网卡一致，没啥区别。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/iperf3-windows-usbc.webp">iperf3测速(USB-C接口)</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/iperf3-windows-usba.webp">iperf3测速(USB-A接口)</div></div><h2 id="Android手机平台">5.2 &nbsp&nbsp<a href="#Android手机平台" class="headerlink" title="Android手机平台"></a>Android手机平台</h2><p>测试平台：</p><ul><li>手机：GT NEO 3 RMX3560</li><li>Android：14</li><li>iperf3：CloudCampus APP内置的iperf3工具</li></ul><p>关闭移动数据和WiFi，将网卡通过USB-C接口接入到手机中，打开开发者选项查看可知，手机是通过<code>RNDIS</code>方式（USB以太网，通过USB设备模拟为以太网接口）完成驱动适配的。通过<code>termux</code>应用查看IP，可看到该USB网卡也正常获取分配下来的IP。</p><p>但手机的<code>realme UI 5.0</code>系统本身并未提供修改USB网卡的IP分配方式的入口，这点比较可惜，这意味着没法设置为手动固定IP。因为手机也并未解锁BL获取ROOT权限，因此也没法通过<code>termux</code>设置IP这种系统相关参数。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/test-phone.webp">手机版本</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/test-phone-driver.webp">手机USB网卡驱动方式</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/test-phone-ip.webp">手机USB网卡IP</div></div><p>Android手机测速结果为<code>304Mbps</code>。</p><p>对的，你没看错，测试用的<code>GT NEO 3</code>手机就只能跑到这个速率，不知道是系统上的限制还是联发科芯片的问题。为什么这样说呢？因为我额外找过朋友拿一个高通芯片的手机测试，网卡测速是能上到九百兆的。以后买手机，还是尽量买高通芯片吧。</p><div class="flex-column"><img data-src="/images/post-articles/2025-10/airsky-usb-c-usb-a-gigabit-ethernet-adapter-review/iperf3-android.webp">iperf3测速-Android</div><h1 id="总结">6 &nbsp&nbsp<a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>经常有调试网络设备的需求的朋友，可以考虑入手一个这样的USB网卡产品。</p><p>大部分普通的调试需求，只需要带个手机+USB网卡就行，十分地轻松便捷。</p><p>若手机有ROOT权限更佳，完全可以替代电脑进行调试工作，包括可以调整IP分配方式。</p><p>手机若没有ROOT，调试场景就比较受限，只推荐接入到已开启DHCP服务器的局域网中，这样也能避开手机无法手动设置固定IP的问题。</p><h1 id="参考文献">7 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] Realtek USB FE &#x2F; GbE &#x2F; 2.5GbE &#x2F; 5G &#x2F; 10G Family Controller Software[EB&#x2F;OL]. <a href="https://www.realtek.com/Download/List?cate_id=585">https://www.realtek.com/Download/List?cate_id=585</a>.<br>[2] devicehunt[EB&#x2F;OL]. <a href="https://devicehunt.com/view/type/usb/vendor/0BDA/device/8153">https://devicehunt.com/view/type/usb/vendor/0BDA/device/8153</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;前段时间从某宝上淘了一个USB外置网卡（USB C&amp;#x2F;USB</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="Airsky" scheme="https://mister-kin.github.io/tags/Airsky/"/>
    
    <category term="USB网卡" scheme="https://mister-kin.github.io/tags/USB%E7%BD%91%E5%8D%A1/"/>
    
    <category term="外置网卡" scheme="https://mister-kin.github.io/tags/%E5%A4%96%E7%BD%AE%E7%BD%91%E5%8D%A1/"/>
    
    <category term="评测" scheme="https://mister-kin.github.io/tags/%E8%AF%84%E6%B5%8B/"/>
    
    <category term="千兆" scheme="https://mister-kin.github.io/tags/%E5%8D%83%E5%85%86/"/>
    
  </entry>
  
  <entry>
    <title>飞牛fnOS调整AutoBangumi参数，以适配国内直连域名订阅mikanime.tv</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/auto-bangumi-set-mikanimetv-for-fnos/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/auto-bangumi-set-mikanimetv-for-fnos/</id>
    <published>2025-10-26T10:33:33.000Z</published>
    <updated>2025-10-26T19:54:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">1 &nbsp&nbsp<a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>mikan站点目前是根据访问IP地区跳转域名，大陆IP是访问<code>mikanime.tv</code>域名，其他IP是访问<code>mikanani.me</code>域名。</p><p>在飞牛fnOS的应用中心上安装<code>AutoBangumi</code>，使用<code>mikanime.tv</code>域名的订阅链接进行下载时，会发现在<code>AutoBangumi</code>的日志中发现这样的警告信息<code>[Network] Failed to get torrents: https://mikanani.me/RSS/xxxxxx</code>。</p><p>很奇怪对吧！明明填写的是<code>mikanime.tv</code>域名的订阅链接，但是日志却是提示无法从<code>mikanani.me</code>域名链接中获取磁力呢？</p><p>原因是<code>AutoBangumi</code>的磁力搜索功能是根据<code>config/search_provider.json</code>中的url参数实现的，而该配置文件的参数默认为<code>mikanani.me</code>域名的url。</p><h1 id="配置方法">2 &nbsp&nbsp<a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h1><p>测试版本：</p><ul><li>飞牛版本：fnOS 0.9.32</li><li>AutoBangumi版本：3.1.18</li></ul><p>在<code>文件管理</code>应用中找到<code>AutoBangumi</code>的应用配置文件：<code>存储空间1/应用文件/AutoBangumi/config/search_provider.json</code>，对应的原始路径是<code>/vol1/@appshare/AutoBangumi/config/search_provider.json</code>。</p><p>使用<code>文本编辑器</code>应用打开并编辑文件内容（确保已经提前在<code>应用中心</code>安装<code>文本编辑器</code>）：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mikan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mikanani.me/RSS/Search?searchstr=%s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nyaa&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://nyaa.si/?page=rss&amp;q=%s&amp;c=0_0&amp;f=0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dmhy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://dmhy.org/topics/rss/rss.xml?keyword=%s&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>将<code>mikan</code>的域名从<code>mikanani.me</code>更改为<code>mikanime.tv</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mikan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mikanime.tv/RSS/Search?searchstr=%s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nyaa&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://nyaa.si/?page=rss&amp;q=%s&amp;c=0_0&amp;f=0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dmhy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://dmhy.org/topics/rss/rss.xml?keyword=%s&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/auto-bangumi-set-mikanimetv-for-fnos/config-path.webp">配置路径</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/auto-bangumi-set-mikanimetv-for-fnos/config-file.webp">配置文件</div></div><p>P.S. 如果局域网网络整体被梯子代理的话，记得将飞牛fnOS的系统IP分流出去，不然处于代理状态下，配置了<code>mikanime.tv</code>也会自动跳转到<code>mikanani.me</code>。</p><h1 id="参考文献">3 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] [错误报告]RSS订阅为国内域名(mikanime.tv)，但torrent获取仍为mikanime.me，以致出现网络连接失败问题[EB&#x2F;OL]. <a href="https://github.com/EstrellaXD/Auto_Bangumi/issues/804">https://github.com/EstrellaXD/Auto_Bangumi/issues/804</a>.<br>[2] 网络问题[EB&#x2F;OL]. <a href="https://www.autobangumi.org/faq/network.html">https://www.autobangumi.org/faq/network.html</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="fnOS" scheme="https://mister-kin.github.io/tags/fnOS/"/>
    
    <category term="飞牛" scheme="https://mister-kin.github.io/tags/%E9%A3%9E%E7%89%9B/"/>
    
    <category term="AutoBangumi" scheme="https://mister-kin.github.io/tags/AutoBangumi/"/>
    
    <category term="mikan" scheme="https://mister-kin.github.io/tags/mikan/"/>
    
  </entry>
  
  <entry>
    <title>Hexo博客添加robots.txt、ads.txt等文件到站点根目录</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/hexo-add-robots/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/hexo-add-robots/</id>
    <published>2025-10-24T19:20:22.000Z</published>
    <updated>2025-10-25T07:57:53.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">1 &nbsp&nbsp<a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如果想要添加一些文件到Hexo博客站点的根目录之下，该如何实现？例如添加<code>robots.txt</code>规范爬虫的规则文件或者AdSense的<code>ads.txt</code>的验证文件。</p><h1 id="配置方法">2 &nbsp&nbsp<a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h1><p>从hexo博客的目录结构和构建方法来看，一般有两个路径可存放：</p><ul><li>将文件置于根目录之下的<code>source</code>文件夹内：这种方式，在运行<code>hexo generate</code>构建时，会自动拷贝文件到<code>public</code>目录之下。</li><li>将文件置于根目录之下的<code>public</code>文件夹内：这种方式，只适合每次手动添加。因为运行<code>hexo clean</code>命令时，<code>public</code>目录会被先清除之后再通过<code>hexo generate</code>重建。</li></ul><h1 id="总结">3 &nbsp&nbsp<a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>如果该资源文件一般不怎么需要频繁改动时，则推荐放到<code>source</code>文件夹内。</p><p>如果是经常需要改动的话，可以配置CI&#x2F;CD等工作流实现自动生成或者获取最新文件，置于<code>public</code>文件夹内。</p><h1 id="参考文献">4 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] 给博客增加 Sitemap 和 Robots（Hexo）[EB&#x2F;OL]. <a href="https://www.guozhenyi.com/post/2025/03/14/hexo-site-add-sitemap-and-robots.html">https://www.guozhenyi.com/post/2025/03/14/hexo-site-add-sitemap-and-robots.html</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="Hexo" scheme="https://mister-kin.github.io/tags/Hexo/"/>
    
    <category term="robots.txt" scheme="https://mister-kin.github.io/tags/robots-txt/"/>
    
    <category term="ads.txt" scheme="https://mister-kin.github.io/tags/ads-txt/"/>
    
  </entry>
  
  <entry>
    <title>控制N卡风扇转速最简单的方式</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/easy-control-nvidia-graphic-card/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/easy-control-nvidia-graphic-card/</id>
    <published>2025-10-24T10:53:37.000Z</published>
    <updated>2025-10-25T07:57:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>英伟达显卡驱动程序中自带包含一个Nvidia APP程序，该应用可以控制显卡风扇转速。</p><p>具体详细位置：系统-&gt;性能-&gt;风扇速度目标 (%)，其中可以设置手动模式或者自动模式。</p><p>Nvidia APP自566.36驱动程序版本起，就成为驱动组件的一部分。</p><div class="flex-column"><img data-src="/images/post-articles/2025-10/easy-control-nvidia-graphic-card/nvidia-app.webp">Nvidia APP控制风扇转速</div>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;英伟达显卡驱动程序中自带包含一个Nvidia APP程序，该应用可以控制显卡风扇转速。&lt;/p&gt;
&lt;p&gt;具体详细位置：系统-&amp;gt;性能-&amp;gt;风扇速度目标 (%)，其中可以设置手动模式或者自动模式。&lt;/p&gt;
&lt;p&gt;Nvidia</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="GPU" scheme="https://mister-kin.github.io/tags/GPU/"/>
    
    <category term="Nvidia APP" scheme="https://mister-kin.github.io/tags/Nvidia-APP/"/>
    
    <category term="GPU温度管理技巧" scheme="https://mister-kin.github.io/tags/GPU%E6%B8%A9%E5%BA%A6%E7%AE%A1%E7%90%86%E6%8A%80%E5%B7%A7/"/>
    
    <category term="控制风扇转速" scheme="https://mister-kin.github.io/tags/%E6%8E%A7%E5%88%B6%E9%A3%8E%E6%89%87%E8%BD%AC%E9%80%9F/"/>
    
  </entry>
  
  <entry>
    <title>拒绝网络垃圾，识别避开内容农场</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/content-farm-terminator/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/content-farm-terminator/</id>
    <published>2025-10-23T21:41:29.000Z</published>
    <updated>2025-10-24T01:29:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="什么是内容农场">1 &nbsp&nbsp<a href="#什么是内容农场" class="headerlink" title="什么是内容农场"></a>什么是内容农场</h1><p>相信不少朋友在网上冲浪时，经常会碰到一些内容网站，一天能产出发布几十篇文章，内容包罗万象但浅薄。</p><p>查阅这些文章的内容，不少甚至是错误的，完全是机器或者纯AI生成的无意义文章。</p><p>例如下面截图的这个「云原生实践」的网站，域名是<code>oryoy.com</code>，严重污染各大搜索引擎的搜索结果，尤其是bing必应搜索，污染最为严重。</p><div class="flex-column"><img data-src="/images/post-articles/2025-10/content-farm-terminator/trash-website.webp">垃圾网站-内容农场</div><p>这类网站就是内容农场（Content Farm），内容粗制滥造、缺乏求证，但这类网站SEO优化很厉害，一大堆热门关键词被搜索引擎搜录，导致搜索结果前段基本都是被内容农场填满。</p><h1 id="浏览器插件推荐：终结内容农场">2 &nbsp&nbsp<a href="#浏览器插件推荐：终结内容农场" class="headerlink" title="浏览器插件推荐：终结内容农场"></a>浏览器插件推荐：终结内容农场</h1><p>「终结内容农场」插件的诞生就是为了避开浏览这些垃圾网站。</p><p>插件的功能：</p><ul><li>自动检测搜索返回结果中的网站是否为内容农场，并加以标识，可以让用户第一时间避开点击。</li><li>即使误操作点击访问了内容农场，插件也会自动弹出封锁页面，让用户能及时关闭。</li><li>通过点击「查看」按钮也能查看被封锁的页面，插件会自动去除内容农场网站的广告，从而避免给它带来广告收益。</li><li>除了上述功能外，插件本身也能自定义黑名单，白名单等。</li></ul><p>插件的安装地址：</p><ul><li>火狐浏览器Firefox（也支持安卓版的Firefox版本）：<a href="https://addons.mozilla.org/zh-CN/firefox/addon/content-farm-terminator">https://addons.mozilla.org/zh-CN/firefox/addon/content-farm-terminator</a></li><li>微软EDGE浏览器：<a href="https://microsoftedge.microsoft.com/addons/detail/%E7%BB%88%E7%BB%93%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA/fgckcfkpckemdnnejbbfkkchanedbeje">https://microsoftedge.microsoft.com/addons/detail/%E7%BB%88%E7%BB%93%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA/fgckcfkpckemdnnejbbfkkchanedbeje</a></li><li>谷歌Chrome浏览器：<a href="https://chromewebstore.google.com/detail/content-farm-terminator/lcghoajegeldpfkfaejegfobkapnemjl">https://chromewebstore.google.com/detail/content-farm-terminator/lcghoajegeldpfkfaejegfobkapnemjl</a></li></ul><p>插件项目的地址：</p><ul><li>主页：<a href="https://danny0838.github.io/content-farm-terminator/zh/">https://danny0838.github.io/content-farm-terminator/zh/</a></li><li>Github仓库：<a href="https://github.com/danny0838/content-farm-terminator">https://github.com/danny0838/content-farm-terminator</a></li></ul><div class="flex-column"><img data-src="/images/post-articles/2025-10/content-farm-terminator/edge-adddon.webp">插件安装页面-微软EDGE浏览器</div><h1 id="安装实测效果">3 &nbsp&nbsp<a href="#安装实测效果" class="headerlink" title="安装实测效果"></a>安装实测效果</h1><p><strong>测试浏览器版本：Microsoft Edge v141.0.3537.99</strong></p><p>浏览器安装启用「终结内容农场」插件后，若搜索返回的结果中存在内容农场站点，可以看到插件自动添加感叹号标识出来。</p><p>即使误点击网站，插件也会首先弹出封锁页面。</p><div class="flex-row"><div class="flex-column"><img data-src="/images/post-articles/2025-10/content-farm-terminator/addon-effect1.webp">插件自动标识出内容农场</div><div class="flex-column"><img data-src="/images/post-articles/2025-10/content-farm-terminator/addon-effect2.webp">插件封锁页面</div></div>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;什么是内容农场&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#什么是内容农场&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="浏览器插件" scheme="https://mister-kin.github.io/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/"/>
    
    <category term="内容农场" scheme="https://mister-kin.github.io/tags/%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA/"/>
    
    <category term="终结内容农场" scheme="https://mister-kin.github.io/tags/%E7%BB%88%E7%BB%93%E5%86%85%E5%AE%B9%E5%86%9C%E5%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>为飞牛fnOS设置定时自动清空回收站</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/auto-emtpy-bin-for-fnos/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/auto-emtpy-bin-for-fnos/</id>
    <published>2025-10-22T22:09:56.000Z</published>
    <updated>2025-10-23T00:45:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="背景">1 &nbsp&nbsp<a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>截止2025-10-23，fnOS 0.9.30系统版本并没有提供官方软件工具执行计划任务，来实现自动清空回收站。</p><p>但手动执行清理日常使用fnOS系统中产生的回收站文件也是很繁琐。</p><p>fnOS是基于Debian系统开发定制的操作系统，那么可以通过Debian的crontab功能实现自动执行命令来完成定时自动清空回收站。</p><h1 id="设置步骤">2 &nbsp&nbsp<a href="#设置步骤" class="headerlink" title="设置步骤"></a>设置步骤</h1><p><strong>测试飞牛版本：fnOS 0.9.30</strong></p><h2 id="开启飞牛SSH功能并登录">2.1 &nbsp&nbsp<a href="#开启飞牛SSH功能并登录" class="headerlink" title="开启飞牛SSH功能并登录"></a>开启飞牛SSH功能并登录</h2><div class="flex-column"><img data-src="/images/post-articles/2025-10/auto-emtpy-bin-for-fnos/enable-ssh.webp">启用飞牛fnOS的SSH功能</div><p>开启SSH功能之后，输入如下命令登录飞牛fnOS系统：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh admin@飞牛ip</span><br><span class="line"><span class="comment"># 例如 ssh admin@192.168.1.10</span></span><br><span class="line"><span class="comment"># 然后输入帐号密码完成验证即可登录</span></span><br></pre></td></tr></table></figure><h2 id="设置crontab定时任务">2.2 &nbsp&nbsp<a href="#设置crontab定时任务" class="headerlink" title="设置crontab定时任务"></a>设置crontab定时任务</h2><p>首先来了解飞牛存储空间的回收站路径：<code>/vol1/1000/.@#local/trash</code>，<code>vol1</code>是代表<code>存储空间1</code>，<code>1000</code>是代表飞牛fnOS系统中的<code>第一个用户帐号</code>。</p><p>运行如下命令，编辑当前用户的定时任务列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>首次执行编辑时，shell会提示让你选择编辑器，输入1选择nano编辑器就行。</p><div class="flex-column"><img data-src="/images/post-articles/2025-10/auto-emtpy-bin-for-fnos/select-editor.webp">选择nano编辑器</div><p>然后在底部输入如下crontab表达式，<code>rm -rf</code>代表强制递归删除，<code>*</code>是通配符，代表匹配了<code>/vol1/1000/.@#local/trash</code>之下所有文件和目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * * <span class="built_in">rm</span> -rf /vol1/1000/.@#<span class="built_in">local</span>/trash/*</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/post-articles/2025-10/auto-emtpy-bin-for-fnos/crontab-expression.webp">输入crontab定时删除任务表达式</div><p>然后<code>Ctrl+S</code>键完成保存，<code>Ctrl+X</code>键退出编辑器。</p><p><code>crontab -e</code>完成编辑保存之后文件实际是存储在<code>/var/spool/cron/crontabs/对应帐号名</code>，例如我的帐号名为<code>admin</code>，该帐号定时任务列表就被存储在<code>/var/spool/cron/crontabs/admin</code>文件中。</p><h2 id="查看验证crontab是否配置成功">2.3 &nbsp&nbsp<a href="#查看验证crontab是否配置成功" class="headerlink" title="查看验证crontab是否配置成功"></a>查看验证crontab是否配置成功</h2><p>输入如下命令查看当前用户的定时任务列表，该命令实际上就是打印输出<code>/var/spool/cron/crontabs/admin</code>文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure><p>查看输出内容跟之前输入表达式无误后，就没问题了。</p><p>输入如下命令可以查看cron后台服务状态，状态显示<code>Active: active (running)</code>就代表服务正常运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status cron.service</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/post-articles/2025-10/auto-emtpy-bin-for-fnos/cron-service.webp">cron后台服务状态运行正常</div><h2 id="关闭飞牛SSH功能">2.4 &nbsp&nbsp<a href="#关闭飞牛SSH功能" class="headerlink" title="关闭飞牛SSH功能"></a>关闭飞牛SSH功能</h2><p>如果读者fnOS系统是接入公网访问的话，上述设置完成之后，切记关闭飞牛SSH功能，避免被网络攻击者恶意攻击。</p><p>或者考虑更换SSH的端口、禁用密码登录仅使用密钥访问、部署Crowdsec或者Fail2Ban工具、端口敲门等手段来保证SSH服务的安全。</p><h1 id="延伸内容：crontab的表达式">3 &nbsp&nbsp<a href="#延伸内容：crontab的表达式" class="headerlink" title="延伸内容：crontab的表达式"></a>延伸内容：crontab的表达式</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* * * * * command_to_execute</span><br><span class="line">- - - - -</span><br><span class="line">| | | | |</span><br><span class="line">| | | | +----- 星期几 (0 - 7) (星期日为0或7)</span><br><span class="line">| | | +------- 月份 (1 - 12)</span><br><span class="line">| | +--------- 日 (1 - 31)</span><br><span class="line">| +----------- 小时 (0 - 23)</span><br><span class="line">+------------- 分钟 (0 - 59)</span><br></pre></td></tr></table></figure><p>特殊符号：<br><code>*</code> : 代表所有可能的值。<br><code>,</code> : 指定多个值，例如「1,3,5」。<br><code>-</code> : 指定一个范围，例如「1-5」。<br><code>/</code> : 指定间隔频率，例如「*&#x2F;2」表示每两单位。</p><p>crontab的表达式示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 2 * * * /root/command.sh <span class="comment"># 每天凌晨2点执行脚本，把2改成0，就是每天凌晨0点</span></span><br><span class="line">0 17 * * 1-5 /root/command.sh <span class="comment"># 每周一到周五的下午5点执行脚本</span></span><br><span class="line">*/10 * * * * /root/command.sh <span class="comment"># 每10分钟执行一次脚本</span></span><br></pre></td></tr></table></figure><h1 id="参考文献">4 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] 飞牛能自动清空回收站吗?[EB&#x2F;OL]. <a href="https://club.fnnas.com/forum.php?mod=viewthread&tid=24685">https://club.fnnas.com/forum.php?mod=viewthread&amp;tid=24685</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;背景&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;截止2025-10-23，fnOS</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="fnOS" scheme="https://mister-kin.github.io/tags/fnOS/"/>
    
    <category term="飞牛" scheme="https://mister-kin.github.io/tags/%E9%A3%9E%E7%89%9B/"/>
    
    <category term="NAS" scheme="https://mister-kin.github.io/tags/NAS/"/>
    
    <category term="homelab" scheme="https://mister-kin.github.io/tags/homelab/"/>
    
    <category term="回收站" scheme="https://mister-kin.github.io/tags/%E5%9B%9E%E6%94%B6%E7%AB%99/"/>
    
  </entry>
  
  <entry>
    <title>禁用SSH服务的密码登录功能以防被爆破</title>
    <link href="https://mister-kin.github.io/post-articles/2025-10/disable-ssh-password/"/>
    <id>https://mister-kin.github.io/post-articles/2025-10/disable-ssh-password/</id>
    <published>2025-10-20T15:40:26.000Z</published>
    <updated>2025-10-22T14:39:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="背景">1 &nbsp&nbsp<a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>想起来家里部署的PVE服务器中，有一个映射到公网IPv4的LXC容器SSH服务并未禁用密码登录。</p><p>于是登录机器查看日志，发现日志中充斥一大堆SSH爆破登录失败的记录，还好当初设置密码并非弱密码，否则早被攻击者爆破成功了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u ssh --since yesterday</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/post-articles/2025-10/disable-ssh-password/sshd-log.webp">SSHD服务日志</div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lastb -s yesterday</span><br></pre></td></tr></table></figure><div class="flex-column"><img data-src="/images/post-articles/2025-10/disable-ssh-password/lastb-log.webp">btmp中的登录失败记录</div><h1 id="针对爆破思考应对方案">2 &nbsp&nbsp<a href="#针对爆破思考应对方案" class="headerlink" title="针对爆破思考应对方案"></a>针对爆破思考应对方案</h1><p>由于映射到公网是使用第三方FRP服务器实现，对应的FRP客户端并未有提供数据，无法分析爆破源的原始IP（从前面的日志截图中可看到记录下来全是映射之后的局域网IP地址），因此基于IP探测封禁等方案也不在考虑范围了。</p><p>思索一番，最后还是觉得直接禁用SSH服务的密码登录方式最简单省事，只保留SSH密钥登录方式。</p><h1 id="解决步骤">3 &nbsp&nbsp<a href="#解决步骤" class="headerlink" title="解决步骤"></a>解决步骤</h1><ol><li>在任意机器上生成SSH密钥和公钥（若已有密钥可以跳过步骤1和步骤2）：<code>-C</code>参数是设置密钥注释，就是备注字眼方便辨识，<code>outside</code>是代表在家庭局域网之外使用的含义，读者可以自定义其他注释;<code>-f</code>参数是将密钥和公钥生成到特定路径下的文件中，<code>~/.ssh/outside_id_ed25519</code>是代表是生成在<code>~/.ssh/</code>路径下。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建密钥和公钥时，若不输入密码直接回车创建的话，代表无密码。</span></span><br><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;outside&quot;</span> -f ~/.ssh/outside_id_ed25519</span><br></pre></td></tr></table></figure></li><li>获取密钥文件<code>outside_id_ed25519</code>和公钥文件<code>outside_id_ed25519.pub</code>。不同系统下<code>~/.ssh/</code>对应的路径如下：<ol><li>Windows：<code>%USERPROFILE%/.ssh</code>或者<code>C:/Users/[用户名]/.ssh</code></li><li>Linux：<code>~/</code>对应的是当前登录帐号家目录的路径，如果是<code>root</code>帐号就是在<code>/root/.ssh</code>中；普通帐号就是在<code>/home/[用户名]/.ssh</code>，直接<code>cd</code>到该路径就行。</li></ol></li><li>SSH登录到目标服务器（使用密码或者已有的旧密钥完成登录）。</li><li>上传公钥到目标服务器，编辑<code>authorized_keys</code>文件，并复制粘贴<code>outside_id_ed25519.pub</code>的内容到<code>authorized_keys</code>文件里面，有多个公钥的话，则分行输入。当然，也可以使用<code>ssh-copy-id</code>命令完成上传公钥，这里不再开展，以下介绍手动编辑的方式。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 若不存在~/.ssh路径，则先创建该文件夹</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.ssh</span><br><span class="line">nano ~/.ssh/authorized_keys</span><br><span class="line"><span class="comment"># 将公钥文件内容复制到authorized_keys文件中</span></span><br></pre></td></tr></table></figure></li><li>设置SSH服务器禁用密码登录 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 找到如下字段修改成右边的值</span></span><br><span class="line">PermitRootLogin prohibit-password <span class="comment"># 代表root帐号只允许密钥验证</span></span><br><span class="line">PasswordAuthentication no <span class="comment"># 代表禁用密码登录</span></span><br></pre></td></tr></table></figure></li><li>重启sshd服务 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd.service</span><br></pre></td></tr></table></figure></li></ol><p>P.S. 若以上命令执行时遇到权限限制报错<code>Permission denied</code>，可以在命令前面加上<code>sudo</code>提权完成执行命令。</p><h1 id="后记">4 &nbsp&nbsp<a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>若读者拥有自己的云服务器或者公网IP的话，可以尝试部署Crowdsec或者Fail2Ban工具实现拉黑攻击者的IP地址。</p><p>或者采用端口敲门方案来保护SSH服务，该方案会在服务器中运行一个<code>Knockd</code>守护进程，只有用户向服务器发送特定的端口序列连接请求之后，服务端验证无误才会允许服务器在一段时间内开放目标端口。</p><p>以下是部份工具的Github仓库地址：</p><ul><li><a href="https://github.com/crowdsecurity/crowdsec">Crowdsec</a></li><li><a href="https://github.com/fail2ban/fail2ban">Fail2Ban</a></li></ul><h1 id="参考文献">5 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] How to View and Check SSH Logs (Linux, Ubuntu, Debian)[EB&#x2F;OL]. <a href="https://www.strongdm.com/blog/view-ssh-logs">https://www.strongdm.com/blog/view-ssh-logs</a>.<br>[2] 使用端口敲门来保护 SSH 服务 (Debian&#x2F;Ubuntu)[EB&#x2F;OL]. <a href="https://cn.linux-terminal.com/?p=3217">https://cn.linux-terminal.com/?p=3217</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;背景&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="post-articles" scheme="https://mister-kin.github.io/categories/post-articles/"/>
    
    <category term="2025-10" scheme="https://mister-kin.github.io/categories/post-articles/2025-10/"/>
    
    
    <category term="SSH" scheme="https://mister-kin.github.io/tags/SSH/"/>
    
    <category term="密码爆破" scheme="https://mister-kin.github.io/tags/%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4/"/>
    
    <category term="公钥" scheme="https://mister-kin.github.io/tags/%E5%85%AC%E9%92%A5/"/>
    
    <category term="密钥" scheme="https://mister-kin.github.io/tags/%E5%AF%86%E9%92%A5/"/>
    
  </entry>
  
  <entry>
    <title>AI总结</title>
    <link href="https://mister-kin.github.io/software/ai/"/>
    <id>https://mister-kin.github.io/software/ai/</id>
    <published>2025-02-27T15:56:16.000Z</published>
    <updated>2025-02-27T20:02:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LLM大模型">1 &nbsp&nbsp<a href="#LLM大模型" class="headerlink" title="LLM大模型"></a>LLM大模型</h1><h2 id="Ollama安装教程">1.1 &nbsp&nbsp<a href="#Ollama安装教程" class="headerlink" title="Ollama安装教程"></a>Ollama安装教程</h2><ol><li>下载<a href="https://ollama.com/download">Ollama安装包</a></li><li>安装路径<ul><li>默认路径：不使用参数，直接运行安装的话，路径为<code>C:\Users\xxx\AppData\Local\Programs\Ollama</code></li><li>自定义路径安装：<code>OllamaSetup.exe /DIR=&quot;D:\ollama&quot;</code></li></ul></li><li>修改模型路径<ol><li>新建系统环境变量：变量名：<code>OLLAMA_MODELS</code>，变量值：<code>D:\ollama\models</code></li><li>若默认模型路径<code>C:\Users\xxx\.ollama\models</code>已经拉取下载存在模型文件的话，在添加了系统环境变量之后，将<code>C:\Users\xxx\.ollama\models</code>路径下的<code>blobs</code>和<code>manifests</code>两个子文件夹剪切移动至<code>D:\ollama\models</code>下即可</li><li>重启ollama后台进程，运行<code>ollama list</code>验证模型迁移是否成功。</li></ol></li></ol><p>常见的ollama命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  ollama [flags]</span><br><span class="line">  ollama [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  serve       Start ollama</span><br><span class="line">  create      Create a model from a Modelfile</span><br><span class="line">  show        Show information for a model</span><br><span class="line">  run         Run a model</span><br><span class="line">  stop        Stop a running model</span><br><span class="line">  pull        Pull a model from a registry</span><br><span class="line">  push        Push a model to a registry</span><br><span class="line">  list        List models</span><br><span class="line">  ps          List running models</span><br><span class="line">  cp          Copy a model</span><br><span class="line">  rm          Remove a model</span><br><span class="line">  help        Help about any command</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --help      help for ollama</span><br><span class="line">  -v, --version   Show version information</span><br><span class="line"></span><br><span class="line">Use &quot;ollama [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure><h1 id="Stable-Diffusion">2 &nbsp&nbsp<a href="#Stable-Diffusion" class="headerlink" title="Stable Diffusion"></a>Stable Diffusion</h1><h2 id="ComfyUI本地手动安装">2.1 &nbsp&nbsp<a href="#ComfyUI本地手动安装" class="headerlink" title="ComfyUI本地手动安装"></a>ComfyUI本地手动安装</h2><ol><li>克隆ComfyUI仓库：<code>git clone https://github.com/comfyanonymous/ComfyUI.git</code></li><li>安装PyTorch：<code>pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu126</code></li><li>安装依赖：<code>pip install -r requirements.txt</code></li><li>SD模型存放路径：<code>models/checkpoints</code></li><li>VAE模型存放路径：<code>models/vae</code></li><li>安装ComfyUI-Manager：在<code>ComfyUI/custom_nodes</code>路径下运行：<code>git clone https://github.com/ltdrdata/ComfyUI-Manager.git</code>，并刷新网页。</li><li>运行ComfyUI：<code>python main.py --front-end-version Comfy-Org/ComfyUI_frontend@latest</code></li></ol><h2 id="Stable-Diffusion-Webui局域网多人共享">2.2 &nbsp&nbsp<a href="#Stable-Diffusion-Webui局域网多人共享" class="headerlink" title="Stable Diffusion Webui局域网多人共享"></a>Stable Diffusion Webui局域网多人共享</h2><p>默认情况下，Stable Diffusion Webui实现的局域网共享，无法实现多人队列提交，并且SD模型和VAE模型是全局设置，一人改变会导致后台改变，而网页端显示的值并未变化更新。</p><p>队列提交&#x2F;多人共享使用的一些插件实现：</p><ul><li><a href="https://github.com/ArtVentureX/sd-webui-agent-scheduler">sd-webui-agent-scheduler</a></li><li><a href="https://github.com/wolverinn/stable-diffusion-multi-user">stable-diffusion-multi-user</a></li></ul><p>多人共享使用的一些问题讨论：</p><ul><li><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/11531">multiple users use it at the same time</a></li></ul><h2 id="Stable-Diffusion-Webui多卡算力">2.3 &nbsp&nbsp<a href="#Stable-Diffusion-Webui多卡算力" class="headerlink" title="Stable Diffusion Webui多卡算力"></a>Stable Diffusion Webui多卡算力</h2><p>当前Webui并未支持多卡同时加速计算，通过共享实例进程实现多人使用（队列提交）均衡多卡负载倒是可以实现。</p><h1 id="Yolo目标检测框架">3 &nbsp&nbsp<a href="#Yolo目标检测框架" class="headerlink" title="Yolo目标检测框架"></a>Yolo目标检测框架</h1><h2 id="毛囊检测">3.1 &nbsp&nbsp<a href="#毛囊检测" class="headerlink" title="毛囊检测"></a>毛囊检测</h2><ul><li>数据集：<ul><li><a href="https://universe.roboflow.com/project-0iwdt/hair-tootr/dataset/3">hair Image Dataset</a></li><li><a href="https://drive.google.com/file/d/1rMw8OzgxuTOSqKD8EBPN_BYXW18q9d3H/view">FDU_HairFollicleDataset.zip</a></li></ul></li><li>论文资料<ul><li><a href="https://dl.acm.org/doi/abs/10.1007/978-3-031-44207-0_4">A New Dataset for Hair Follicle Recognition and Classification in Robot-Aided Hair Transplantation</a></li><li>上一篇论文镜像链接（附有数据集下载链接，已明写在上一小节）<a href="https://link.springer.com/chapter/10.1007/978-3-031-44207-0_4">A New Dataset for Hair Follicle Recognition and Classification in Robot-Aided Hair Transplantation</a></li></ul></li></ul><h1 id="参考文献">4 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] Accelerate doesn&#39;t use multi GPU with automatic1111[EB&#x2F;OL]. <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/13942">https://github.com/AUTOMATIC1111/stable-diffusion-webui/discussions/13942</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;LLM大模型&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#LLM大模型&quot; class=&quot;headerlink&quot; title=&quot;LLM大模型&quot;&gt;&lt;/a&gt;LLM大模型&lt;/h1&gt;&lt;h2 id=&quot;Ollama安装教程&quot;&gt;1.1 &amp;nbsp&amp;nbsp&lt;a</summary>
        
      
    
    
    
    <category term="software" scheme="https://mister-kin.github.io/categories/software/"/>
    
    
    <category term="总结" scheme="https://mister-kin.github.io/tags/%E6%80%BB%E7%BB%93/"/>
    
    <category term="SD" scheme="https://mister-kin.github.io/tags/SD/"/>
    
    <category term="stable diffusion" scheme="https://mister-kin.github.io/tags/stable-diffusion/"/>
    
    <category term="stable diffusion webui" scheme="https://mister-kin.github.io/tags/stable-diffusion-webui/"/>
    
    <category term="AIGC" scheme="https://mister-kin.github.io/tags/AIGC/"/>
    
    <category term="AI" scheme="https://mister-kin.github.io/tags/AI/"/>
    
    <category term="yolo" scheme="https://mister-kin.github.io/tags/yolo/"/>
    
  </entry>
  
  <entry>
    <title>开发总结</title>
    <link href="https://mister-kin.github.io/code/code/"/>
    <id>https://mister-kin.github.io/code/code/</id>
    <published>2025-01-19T18:32:31.000Z</published>
    <updated>2025-10-17T22:47:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="关于开源协议">1 &nbsp&nbsp<a href="#关于开源协议" class="headerlink" title="关于开源协议"></a>关于开源协议</h1><p>如果想要基于已有开源协议上附加个别自定协议，可以参考如下内容：</p><p>基于Mozilla Public License Version 2.0并附加以下条款：</p><ul><li>非商业性使用 — 不得将此项目及其衍生的项目的源代码和二进制产品用于任何商业和盈利用途</li></ul><h1 id="语言编码的区别">2 &nbsp&nbsp<a href="#语言编码的区别" class="headerlink" title="语言编码的区别"></a>语言编码的区别</h1><p>语言码对照表参考资料：<a href="https://simplelocalize.io/data/locales/">List of locale codes</a></p><ul><li>zh-CN：中国大陆区域的中文。包括各种大方言、小方言、繁体、简体等等都可以被匹配到。</li><li>zh-Hans：简体中文。适用区域范围是全宇宙用中文简体的地方，内容包括各种用简体的方言等。</li></ul><h1 id="关于项目开发的语言技术栈选择">3 &nbsp&nbsp<a href="#关于项目开发的语言技术栈选择" class="headerlink" title="关于项目开发的语言技术栈选择"></a>关于项目开发的语言技术栈选择</h1><ul><li>B&#x2F;S（Browser&#x2F;Server）业务开发一般推荐Java，相关技术栈和框架比较成熟。而不推荐C++，效率太低。</li></ul><h1 id="开发记录">4 &nbsp&nbsp<a href="#开发记录" class="headerlink" title="开发记录"></a>开发记录</h1><h2 id="关于字节的一些记录">4.1 &nbsp&nbsp<a href="#关于字节的一些记录" class="headerlink" title="关于字节的一些记录"></a>关于字节的一些记录</h2><p>int在机器上占一个字长，而32位机器中，一个字长就是4Byte，64位机器 一个字长就是8Byte。这里指的是在64位机器上的运行64位操作系统，计算的sizeof(int)。</p><p>这个说法不太正确，gcc编译64bit的程序，sizeof(int)输出为4，即4Byte，32bit。</p><h1 id="参考文献">5 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;关于开源协议&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#关于开源协议&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="code" scheme="https://mister-kin.github.io/categories/code/"/>
    
    
  </entry>
  
  <entry>
    <title>数据结构</title>
    <link href="https://mister-kin.github.io/code/data-structure/"/>
    <id>https://mister-kin.github.io/code/data-structure/</id>
    <published>2025-01-16T18:09:44.000Z</published>
    <updated>2025-02-27T16:00:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数组和字符串">1 &nbsp&nbsp<a href="#数组和字符串" class="headerlink" title="数组和字符串"></a>数组和字符串</h1><h2 id="数组">1.1 &nbsp&nbsp<a href="#数组" class="headerlink" title="数组"></a>数组</h2><ul><li>集合的定义：由一个或多个确定的元素所构成的整体。</li><li>集合的特性：<ul><li>集合里的元素类型不一定相同</li><li>集合里的元素没有顺序</li></ul></li><li>列表（又称线性列表）的定义：是一种数据项构成的有限序列，即按照一定的线性顺序，排列而成的数据项的集合。<ul><li>列表的概念是在集合的特征上形成的，它具有顺序，且长度是可变的。</li><li>列表最常见的表现形式：数组和链表<ul><li>C++和Java中，数组中的元素类型必须保持一致。</li><li>Python数组叫list，元素类型可以不同，具有更多高级功能。</li></ul></li><li>特殊类型的列表：栈和队列</li></ul></li><li>列表和数组的区别<ul><li>数组<ul><li>数组有<code>索引</code>，用来标识每项数据在数组中的位置，且在大多数编程语言中，索引是从 0 算起的。</li><li>数组中的元素在内存中是连续存储，且每个元素占用的相同大小内存。</li></ul></li><li>列表<ul><li>列表没有<code>索引</code>。</li><li>列表中的元素在内存中可能彼此相邻，也可能不相邻。例如链表。</li></ul></li></ul></li></ul><h2 id="数组的操作">1.2 &nbsp&nbsp<a href="#数组的操作" class="headerlink" title="数组的操作"></a>数组的操作</h2><p>对于数组，计算机会在内存中为其申请一段<strong>连续</strong>的空间，并且会记下<strong>索引为 0 处的内存地址</strong>。</p><ul><li>读取元素：读取数组中的元素，是通过访问索引的方式来读取的，索引一般从 0 开始。寻找索引为2的元素，实际就是在索引为0的元素内存地址上偏移+2得到新地址的元素。<ul><li>时间复杂度：O(1)</li></ul></li><li>查找元素：由于只保存了索引为 0 处的内存地址，因此需要从数组开头逐步向后查找。<ul><li>时间复杂度：O(N)</li></ul></li><li>插入元素<ul><li>末尾插入：只需要一步（根据数组的长度和位置计算出需插入元素的内存地址插入即可）。</li><li>中间插入：需要在数组中腾出空间，才能继续操作插入（这种操作，更推荐使用链表）。</li></ul></li><li>删除元素：与插入元素类似<ul><li>末尾删除：只需要一步</li><li>中间删除：删除中间元素后，后面的元素需要对该位置进行操作</li><li>时间复杂度：O(N)。数组长度<code>N</code>，例如删除第一个元素，总步骤数：<code>1+(N-1)=N</code>。（<code>1</code>为删除操作，<code>N-1</code>为移动操作）</li></ul></li></ul><h2 id="字符串">1.3 &nbsp&nbsp<a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>字符串是由字符串数组形成的。</p><h1 id="参考文献">2 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] 数组和字符串[EB&#x2F;OL]. <a href="https://leetcode.cn/leetbook/detail/array-and-string/">https://leetcode.cn/leetbook/detail/array-and-string/</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;数组和字符串&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#数组和字符串&quot; class=&quot;headerlink&quot; title=&quot;数组和字符串&quot;&gt;&lt;/a&gt;数组和字符串&lt;/h1&gt;&lt;h2 id=&quot;数组&quot;&gt;1.1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#数组&quot;</summary>
        
      
    
    
    
    <category term="code" scheme="https://mister-kin.github.io/categories/code/"/>
    
    
  </entry>
  
  <entry>
    <title>Programming Ability Test (PAT)</title>
    <link href="https://mister-kin.github.io/code-training/pat/"/>
    <id>https://mister-kin.github.io/code-training/pat/</id>
    <published>2025-01-12T19:11:02.000Z</published>
    <updated>2025-01-16T14:31:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>“程序设计类教学辅助教学平台”（Programming Teaching Assistant，亦简称 PTA）（依稀记得以前这玩意叫PAT），面向高校和社会的程序自动评测、开放式的教学辅助平台。</p><p>练习代码文件的仓库链接：<a href="https://github.com/Mister-Kin/CodeTraining/tree/master/PAT">点击跳转</a>。</p><p>难点题解主要参考<a href="https://github.com/tiny656/PAT">PAT(tiny656)</a>和[<a href="https://gitee.com/branches/PAT">PAT(枝桠)</a>]</p><h1 id="基础编程题目集（PTA平台）"><a href="#基础编程题目集（PTA平台）" class="headerlink" title="基础编程题目集（PTA平台）"></a><a href="https://github.com/Mister-Kin/CodeTraining/tree/master/PAT/BasicProgrammingProblemSet">基础编程题目集</a>（<a href="https://pintia.cn/problem-sets/14/exam/problems/type/6">PTA平台</a>）</h1><h2 id="函数题"><a href="#函数题" class="headerlink" title="函数题"></a>函数题</h2><h3 id="6-1-简单输出整数（PTA平台）"><a href="#6-1-简单输出整数（PTA平台）" class="headerlink" title="6-1 简单输出整数（PTA平台）"></a><a href="https://github.com/Mister-Kin/CodeTraining/blob/master/PAT/BasicProgrammingProblemSet/CodeCompletion/6-1-print_n.c">6-1 简单输出整数</a>（<a href="https://pintia.cn/problem-sets/14/exam/problems/type/6?problemSetProblemId=733">PTA平台</a>）</h3><p>简单的<code>for</code>循环运用</p><h3 id="6-2-多项式求值（PTA平台）"><a href="#6-2-多项式求值（PTA平台）" class="headerlink" title="6-2 多项式求值（PTA平台）"></a><a href="https://github.com/Mister-Kin/CodeTraining/blob/master/PAT/BasicProgrammingProblemSet/CodeCompletion/6-2-multinomial_sum.c">6-2 多项式求值</a>（<a href="https://pintia.cn/problem-sets/14/exam/problems/type/6?problemSetProblemId=734">PTA平台</a>）</h3><p>先罗列多项式值，分析构成规律，再去考虑如何编写逻辑。（当年我是傻乎乎分开两个<code>for</code>循环处理，因此导致会导致部份用例运行超时）</p><h3 id="6-3-简单求和（PTA平台）"><a href="#6-3-简单求和（PTA平台）" class="headerlink" title="6-3 简单求和（PTA平台）"></a><a href="https://github.com/Mister-Kin/CodeTraining/blob/master/PAT/BasicProgrammingProblemSet/CodeCompletion/6-3-sum.c">6-3 简单求和</a>（<a href="https://pintia.cn/problem-sets/14/exam/problems/type/6?problemSetProblemId=735">PTA平台</a>）</h3><p><code>for</code>循环中应为<code>i&lt;N</code>，注意<code>main</code>函数最后赋值的下标，即需要保持和<code>main</code>函数中<code>for</code>循环的条件一致。（当年是挺傻乎乎的）</p><h3 id="6-4-求自定类型元素的平均（PTA平台）"><a href="#6-4-求自定类型元素的平均（PTA平台）" class="headerlink" title="6-4 求自定类型元素的平均（PTA平台）"></a><a href="https://github.com/Mister-Kin/CodeTraining/blob/master/PAT/BasicProgrammingProblemSet/CodeCompletion/6-4-average.c">6-4 求自定类型元素的平均</a>（<a href="https://pintia.cn/problem-sets/14/exam/problems/type/6?problemSetProblemId=736">PTA平台</a>）</h3><p><code>for</code>循环中应为<code>i&lt;N</code>，注意<code>main</code>函数最后赋值的下标，即需要保持和<code>main</code>函数中<code>for</code>循环的条件一致。</p><h3 id="6-5-求自定类型元素的最大值（PTA平台）"><a href="#6-5-求自定类型元素的最大值（PTA平台）" class="headerlink" title="6-5 求自定类型元素的最大值（PTA平台）"></a><a href="https://github.com/Mister-Kin/CodeTraining/blob/master/PAT/BasicProgrammingProblemSet/CodeCompletion/6-5-max_num.c">6-5 求自定类型元素的最大值</a>（<a href="https://pintia.cn/problem-sets/14/exam/problems/type/6?problemSetProblemId=737">PTA平台</a>）</h3><p><code>for</code>循环中应为<code>i&lt;N</code>，注意<code>main</code>函数最后赋值的下标，即需要保持和<code>main</code>函数中<code>for</code>循环的条件一致。</p><p>第一个MaxNum应该设为数组里的元素。如果设为0的话，当元素全为负数时，没法输出最大值。（也不知道我当年是怎么想出这种傻乎乎的逻辑）</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;“程序设计类教学辅助教学平台”（Programming Teaching Assistant，亦简称 PTA）（依稀记得以前这玩意叫PAT），面向高校和社会的程序自动评测、开放式的教学辅助平台。&lt;/p&gt;
&lt;p&gt;练习代码文件的仓库链接：&lt;a</summary>
        
      
    
    
    
    <category term="code-training" scheme="https://mister-kin.github.io/categories/code-training/"/>
    
    
    <category term="总结" scheme="https://mister-kin.github.io/tags/%E6%80%BB%E7%BB%93/"/>
    
    <category term="编程" scheme="https://mister-kin.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
    <category term="PAT" scheme="https://mister-kin.github.io/tags/PAT/"/>
    
    <category term="PTA" scheme="https://mister-kin.github.io/tags/PTA/"/>
    
    <category term="练习" scheme="https://mister-kin.github.io/tags/%E7%BB%83%E4%B9%A0/"/>
    
    <category term="题库" scheme="https://mister-kin.github.io/tags/%E9%A2%98%E5%BA%93/"/>
    
    <category term="题目" scheme="https://mister-kin.github.io/tags/%E9%A2%98%E7%9B%AE/"/>
    
    <category term="算法" scheme="https://mister-kin.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="数据结构" scheme="https://mister-kin.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>力扣LeetCode</title>
    <link href="https://mister-kin.github.io/code-training/leetcode/"/>
    <id>https://mister-kin.github.io/code-training/leetcode/</id>
    <published>2025-01-12T19:10:57.000Z</published>
    <updated>2025-09-26T13:13:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="参考文献">1 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;参考文献&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#参考文献&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="code-training" scheme="https://mister-kin.github.io/categories/code-training/"/>
    
    
  </entry>
  
  <entry>
    <title>搜索引擎</title>
    <link href="https://mister-kin.github.io/search-engine/"/>
    <id>https://mister-kin.github.io/search-engine/</id>
    <published>2024-10-03T15:25:47.000Z</published>
    <updated>2025-01-02T11:33:24.000Z</updated>
    
    <content type="html"><![CDATA[<div class="note info no-icon"><p>搜索技巧：巧用AI GC相关工具和传统搜索引擎方式。</p></div><h1 id="常见搜索需求">1 &nbsp&nbsp<a href="#常见搜索需求" class="headerlink" title="常见搜索需求"></a>常见搜索需求</h1><ul><li>信息资讯</li><li>知识技能</li><li>素材文件</li><li>工具软件</li></ul><h1 id="搜索效率">2 &nbsp&nbsp<a href="#搜索效率" class="headerlink" title="搜索效率"></a>搜索效率</h1><ul><li>一般而言：谷歌&gt;必应&gt;公众号&gt;短视频&gt;百度</li><li>网页搜索：谷歌&gt;搜狗搜索引擎（可搜索公众号文章）&gt;微信APP搜索</li><li>PDF搜索：谷歌限定文件格式语法&gt;垂直类网站</li><li>科研PDF：谷歌学术&gt;SCI-HUB</li></ul><h1 id="谷歌搜索语法">3 &nbsp&nbsp<a href="#谷歌搜索语法" class="headerlink" title="谷歌搜索语法"></a>谷歌搜索语法</h1><ul><li>限定关键词：<code>&quot;关键词&quot;</code>，英文双引号包含关键词</li><li>限定标题：<code>intitle:关键词</code>。此时，关键词并不是限定状态，因此关键词中的字符也可能是乱序查询的。</li><li>限定标题+限定关键词：<code>intitle:&quot;关键词&quot;</code>。此种用法，关键词是限定状态，要求完整出现，不能乱序。</li><li>限定标题+多个关键词：<code>allintitle:关键词1 关键词2</code></li><li>限定内容关键词：<code>intext:关键词</code></li><li>限定网址关键词：<code>inurl:关键词</code>，如<code>inurl:cctv</code></li><li>限定网址来源：<code>site:网址</code>，如<code>site:cctv.com</code>，域名的www可不输入。</li><li>限定图片尺寸：<code>imagesize:分辨率</code>，如<code>imagesize:1920x1080</code></li><li>限定文件格式：<code>filetype:文件后缀名</code>，如<code>filetype:pdf</code></li></ul><h1 id="油管直链转制">4 &nbsp&nbsp<a href="#油管直链转制" class="headerlink" title="油管直链转制"></a>油管直链转制</h1><p>youtube-&gt;9xyoutube</p><h1 id="参考文献">5 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] 搜索技术，普通人变强的唯一外挂。全套详细宝藏教程~[EB&#x2F;OL]. <a href="https://www.youtube.com/watch?v=tiN6T1LewmQ&t=31s">https://www.youtube.com/watch?v=tiN6T1LewmQ&amp;t=31s</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;div class=&quot;note info no-icon&quot;&gt;&lt;p&gt;搜索技巧：巧用AI GC相关工具和传统搜索引擎方式。&lt;/p&gt;
&lt;/div&gt;

&lt;h1 id=&quot;常见搜索需求&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#常见搜索需求&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    
  </entry>
  
  <entry>
    <title>docker</title>
    <link href="https://mister-kin.github.io/code/docker/"/>
    <id>https://mister-kin.github.io/code/docker/</id>
    <published>2024-05-28T18:32:33.000Z</published>
    <updated>2025-09-25T15:22:24.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li><a href="https://www.runoob.com/docker/docker-resources.html">Docker 命令大全</a></li></ul><h1 id="docker的基础命令操作">1 &nbsp&nbsp<a href="#docker的基础命令操作" class="headerlink" title="docker的基础命令操作"></a>docker的基础命令操作</h1><table><thead><tr><th align="center">命令</th><th align="center">功能</th><th align="left">注释</th></tr></thead><tbody><tr><td align="center">docker ps</td><td align="center">列出当前正在运行的容器</td><td align="left"></td></tr><tr><td align="center">docker ps -a</td><td align="center">列出所有容器（包括已停止的容器）</td><td align="left"></td></tr><tr><td align="center">docker logs container_name</td><td align="center">查看指定容器的日志</td><td align="left"></td></tr><tr><td align="center">docker inspect container_name&#x2F;image</td><td align="center">获取指定容器或镜像的详细信息</td><td align="left"></td></tr><tr><td align="center">docker exec -it container_name &#x2F;bin&#x2F;bash<br>docker exec -it container_name sh</td><td align="center">进入指定容器的交互式终端</td><td align="left">-i: 交互式操作<br>-t: 终端<br>-it：以交互式终端运行容器，例如 docker exec -it container_name bash</td></tr><tr><td align="center">docker stop container_name</td><td align="center">停止一个或多个容器</td><td align="left"></td></tr><tr><td align="center">docker kill container_name</td><td align="center">立即停止一个或多个容器</td><td align="left">直接发送 SIGKILL 信号给容器的主进程，导致容器立即停止<br>docker kill -s SIGTERM container_name等同于stop<br>-s, --signal: 发送给容器的信号（默认为 SIGKILL）<br>SIGKILL: 强制终止进程（默认信号）<br>SIGTERM: 请求进程终止<br>SIGINT: 发送中断信号，通常表示用户请求终止<br>SIGHUP: 挂起信号，通常表示终端断开</td></tr><tr><td align="center">docker rm container_name</td><td align="center">删除一个或多个容器</td><td align="left"></td></tr><tr><td align="center">docker rmi image-name:tag</td><td align="center">删除一个或多个镜像</td><td align="left">不加tag则会删除所有</td></tr><tr><td align="center">docker run image-name --name container_name -d</td><td align="center">启动一个新的容器并运行命令</td><td align="left"></td></tr><tr><td align="center">docker start container_name</td><td align="center">启动已停止的容器</td><td align="left"></td></tr><tr><td align="center">docker restart container_name</td><td align="center">重启一个容器</td><td align="left"></td></tr><tr><td align="center">docker version</td><td align="center">显示 Docker 客户端和守护进程的版本信息</td><td align="left"></td></tr><tr><td align="center">docker network ls</td><td align="center">列出所有 Docker 网络</td><td align="left"></td></tr><tr><td align="center">docker volume ls</td><td align="center">列出所有 Docker 卷</td><td align="left"></td></tr><tr><td align="center">docker images ls</td><td align="center">列出本地存储的所有镜像</td><td align="left"></td></tr><tr><td align="center">docker compose -f docker-compose.yml up -d</td><td align="center">启动多容器应用（从 docker-compose.yml 文件）</td><td align="left">-d：后台运行容器，例如 docker run -d ubuntu</td></tr><tr><td align="center">docker compose -f docker-compose.yml down</td><td align="center">停止并删除由 docker-compose 启动的容器、网络等</td><td align="left"></td></tr><tr><td align="center">docker compose logs -f docker-compose.yml</td><td align="center">查看指定compose的运行日志</td><td align="left"></td></tr><tr><td align="center">docker info</td><td align="center">显示 Docker 系统的详细信息</td><td align="left"></td></tr><tr><td align="center">docker stats</td><td align="center">显示容器的实时资源使用情况</td><td align="left"></td></tr><tr><td align="center">docker system df</td><td align="center">查看docker各组件硬盘占用</td><td align="left"></td></tr><tr><td align="center">docker builder prune -f</td><td align="center">删除所有未被使用的构建缓存</td><td align="left">-f：强制删除，跳过确认提示</td></tr><tr><td align="center">docker builder prune --filter &#39;until&#x3D;240h&#39;</td><td align="center">删除所有未被使用的构建缓存，并保留最近10天的缓存</td><td align="left"></td></tr><tr><td align="center">docker image prune -a -f</td><td align="center">强制删除所有未被使用的镜像</td><td align="left">-a：所有镜像，不单只dangling镜像<br>-f：强制删除，跳过确认提示</td></tr><tr><td align="center">docker container prune -f --volumes</td><td align="center">删除所有停止运行的容器</td><td align="left">--volumes：同时删除与容器关联的匿名卷，注意备份好数据<br>-f：强制删除，跳过确认提示</td></tr><tr><td align="center">docker volume prune</td><td align="center">删除所有未被挂载的卷</td><td align="left"></td></tr><tr><td align="center">docker network prune</td><td align="center">删除所有未使用的网络</td><td align="left"></td></tr><tr><td align="center">docker system prune -f</td><td align="center">清理磁盘，删除关闭的容器、无用的数据卷和网络，以及dangling镜像（即无tag的镜像）</td><td align="left">-f：强制删除，跳过确认提示</td></tr><tr><td align="center">docker system prune -a -f</td><td align="center">比上面命令清理得更加彻底，没有容器使用Docker镜像都会被删掉</td><td align="left">-f：强制删除，跳过确认提示</td></tr></tbody></table><h1 id="使用apt仓库为Debian安装docker">2 &nbsp&nbsp<a href="#使用apt仓库为Debian安装docker" class="headerlink" title="使用apt仓库为Debian安装docker"></a>使用apt仓库为Debian安装docker</h1><h2 id="添加Docker的官方GPG密钥">2.1 &nbsp&nbsp<a href="#添加Docker的官方GPG密钥" class="headerlink" title="添加Docker的官方GPG密钥"></a>添加Docker的官方GPG密钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">apt install ca-certificates -y</span><br><span class="line">install -m 0755 -d /etc/apt/keyrings</span><br><span class="line"><span class="comment"># 可能下载会出现ssl验证错误，多重复执行几次wget下载就能成功下载</span></span><br><span class="line">wget https://download.docker.com/linux/debian/gpg -O /etc/apt/keyrings/docker.asc</span><br><span class="line"><span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc</span><br></pre></td></tr></table></figure><h2 id="添加Docker的官方仓库">2.2 &nbsp&nbsp<a href="#添加Docker的官方仓库" class="headerlink" title="添加Docker的官方仓库"></a>添加Docker的官方仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \</span></span><br><span class="line"><span class="string">  <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)</span> stable&quot;</span> | \</span><br><span class="line">  <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">apt update</span><br></pre></td></tr></table></figure><h2 id="安装Docker">2.3 &nbsp&nbsp<a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y</span><br></pre></td></tr></table></figure><h2 id="验证Docker版本">2.4 &nbsp&nbsp<a href="#验证Docker版本" class="headerlink" title="验证Docker版本"></a>验证Docker版本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure><h2 id="修改Docker镜像源">2.5 &nbsp&nbsp<a href="#修改Docker镜像源" class="headerlink" title="修改Docker镜像源"></a>修改Docker镜像源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">    &quot;https://docker.1ms.run&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.mybacc.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://dytt.online&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://lispy.org&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.xiaogenban1993.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.yomansunter.com&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://aicarbon.xyz&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://666860.xyz&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.zhai.cm&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://a.ussh.net&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://hub.littlediary.cn&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://hub.rat.dev&quot;,</span></span><br><span class="line"><span class="string">    &quot;https://docker.m.daocloud.io&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="重启相关服务">2.6 &nbsp&nbsp<a href="#重启相关服务" class="headerlink" title="重启相关服务"></a>重启相关服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h1 id="Docker部署Dockge（docker-compose可视化管理）">3 &nbsp&nbsp<a href="#Docker部署Dockge（docker-compose可视化管理）" class="headerlink" title="Docker部署Dockge（docker compose可视化管理）"></a>Docker部署Dockge（docker compose可视化管理）</h1><div class="note danger no-icon"><ul><li>dockge容器运行是UTC世界时，指定环境变量或者同步宿主机的时区都是无法生效，容器日志纪录的时间戳就是UTC时间——Mr. Kin，2025-05-22</li><li>docker实现的终端功能只有简单shell命令，因此终端更多是使用docker相关命令，其余复杂的操作，还是推荐ssh连接到服务器进行操作。</li></ul></div><div class="note default no-icon"><p><code>/root/dockge_stacks</code>路径下任意文件夹的名称都是作为堆栈stack名称，显示在dockge网页管理后台上。其中，在文件夹内，<code>docker-compose.yml</code>或者<code>compose.yml</code>文件名称是必需，其他自定义文件名称，dockge将无法识别。</p><p>例如，<code>/root/dockge_stacks/dockge</code>文件夹，在dockge网页管理后台上显示为<code>dockge</code>。如果有多个服务器都需要安装dockge，文件夹名称可以加上<code>-server</code>后缀以方便标识，例如<code>dockge-server</code>。</p></div><ol><li>创建stacks文件夹（建议加上<code>-xxx</code>后缀以方便标识）： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /root/dockge_stacks/dockge</span><br></pre></td></tr></table></figure></li><li>创建<code>dockge</code>的<code>docker-compose.yml</code>文件：<code>nano /root/dockge_stacks/dockge/docker-compose.yml</code> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dockge:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">louislam/dockge:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dockge</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5001</span><span class="string">:5001</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/dockge_data:/app/data</span> <span class="comment"># dockge的数据路径</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/dockge_stacks:/opt/stacks</span> <span class="comment"># dockge的stacks堆栈路径，所有docker-compose.yml都在这里管理</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># Tell Dockge where to find the stacks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKGE_STACKS_DIR=/opt/stacks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCKGE_ENABLE_CONSOLE=true</span></span><br></pre></td></tr></table></figure></li><li>进入到对应<code>dockge-[xxx]</code>路径，运行dockge服务：<code>docker compose -f docker-compose.yml up -d</code>。</li><li>访问dockge网页管理后台：<code>http://10.10.10.10:5001</code>。初次访问会提示创建用户和密码。</li></ol><h1 id="Docker部署DDNS-GO">4 &nbsp&nbsp<a href="#Docker部署DDNS-GO" class="headerlink" title="Docker部署DDNS-GO"></a>Docker部署DDNS-GO</h1><h2 id="Docker宿主机配置一览">4.1 &nbsp&nbsp<a href="#Docker宿主机配置一览" class="headerlink" title="Docker宿主机配置一览"></a>Docker宿主机配置一览</h2><p>笔者是直接跟RustDesk server部署在同一个宿主机上。</p><table><thead><tr><th align="center">硬件类别</th><th align="center">配置</th></tr></thead><tbody><tr><td align="center">CPU</td><td align="center">2核</td></tr><tr><td align="center">内存</td><td align="center">1GB</td></tr><tr><td align="center">SWAP</td><td align="center">1GB</td></tr><tr><td align="center">硬盘</td><td align="center">5GB</td></tr></tbody></table><h2 id="创建开源版DDNS-GO的docker-compose-yml文件">4.2 &nbsp&nbsp<a href="#创建开源版DDNS-GO的docker-compose-yml文件" class="headerlink" title="创建开源版DDNS-GO的docker-compose.yml文件"></a>创建开源版DDNS-GO的docker-compose.yml文件</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">ddns-go:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">jeessy/ddns-go:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ddns-go</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/ddns-go_data:/root</span></span><br></pre></td></tr></table></figure><p>访问网页管理后台：<a href="http://10.10.10.10:9876/">http://10.10.10.10:9876</a>，首次访问需要设置帐号和密码。</p><h2 id="DDNS-GO的配置">4.3 &nbsp&nbsp<a href="#DDNS-GO的配置" class="headerlink" title="DDNS-GO的配置"></a>DDNS-GO的配置</h2><ol><li>选择DNS服务器：笔者用的是<code>Dynv6</code>。<ol><li>Token查看：<code>My Zones</code>-&gt;<code>Instructions</code>-&gt;<code>ddclient</code>-&gt;<code>password</code>或者右上角<code>帐号</code>-&gt;<code>Keys</code>-&gt;<code>HTTP Tokens</code>-&gt;<code>Token</code>-&gt;<code>Details</code>（这两个实际是相同，当然也可以<code>Keys</code>中生成新的Token）</li><li>TTL：保持默认的自动。</li></ol></li><li>Ipv4：取消勾选「是否启动」</li><li>Ipv6<ol><li>勾选「是否启动」</li><li>获取IP方式：通过网卡获取</li><li>匹配正则表达式：留空</li><li>Domains：填写在<code>Dynv6</code>申请得到的域名</li></ol></li><li>其他保持默认，当前配置可以重命名保存，注意点击底下的保存按钮。若有其他局域网设备也需要做DDNS，则添加一个新的配置，局域网设备获取IPV6的方式需要支持EUI-64（IPv6后半部分包含ff:fe），具体参看<a href="https://github.com/jeessy2/ddns-go/wiki/%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96IP%E5%8F%82%E8%80%83">通过命令获取IP参考</a>。</li></ol><ul><li>一般默认Linux系统的网卡配置就默认支持EUI-64，通过<code>ip addr</code>查看具有8组长度（每组16位的十六进制数）的Ipv6地址。</li><li><code>ip -6 route | awk &#39;&#123;print $1&#125;&#39; | awk &#39;/240:?/&#39; | awk -F::/ &#39;&#123;print $1 &quot;:填写后面四组的十六进制数，包含ff:fe&quot;&#125;&#39;</code></li></ul><h1 id="Docker部署开源版RustDesk-server">5 &nbsp&nbsp<a href="#Docker部署开源版RustDesk-server" class="headerlink" title="Docker部署开源版RustDesk server"></a>Docker部署开源版RustDesk server</h1><h2 id="Docker宿主机配置一览-1">5.1 &nbsp&nbsp<a href="#Docker宿主机配置一览-1" class="headerlink" title="Docker宿主机配置一览"></a>Docker宿主机配置一览</h2><table><thead><tr><th align="center">硬件类别</th><th align="center">配置</th></tr></thead><tbody><tr><td align="center">CPU</td><td align="center">2核</td></tr><tr><td align="center">内存</td><td align="center">1GB</td></tr><tr><td align="center">SWAP</td><td align="center">1GB</td></tr><tr><td align="center">硬盘</td><td align="center">5GB</td></tr></tbody></table><h2 id="理解开源版RustDesk-server端口用途">5.2 &nbsp&nbsp<a href="#理解开源版RustDesk-server端口用途" class="headerlink" title="理解开源版RustDesk server端口用途"></a>理解开源版RustDesk server端口用途</h2><p>需要开放路由器防火墙和docker映射的端口一览：</p><ul><li><p>TCP(21115, 21116, 21117, 21118, 21119)</p></li><li><p>UDP(21116)</p></li><li><p>hbbs监听端口：</p><ul><li>21115(tcp)：hbbs用作NAT类型测试</li><li>21116(tcp&#x2F;udp)：UDP是hbbs用作ID注册与心跳服务，TCP是hbbs用作TCP打洞与连接服务</li><li>21118(tcp)：支持网页客户端</li></ul></li><li><p>hbbr监听端口：</p><ul><li>21117(tcp)：hbbr用作Relay中继服务</li><li>21119(tcp)：支持网页客户端</li></ul></li></ul><h2 id="创建开源版RustDesk-server的docker-compose-yml文件">5.3 &nbsp&nbsp<a href="#创建开源版RustDesk-server的docker-compose-yml文件" class="headerlink" title="创建开源版RustDesk server的docker-compose.yml文件"></a>创建开源版RustDesk server的docker-compose.yml文件</h2><div class="note danger no-icon"><ul><li>为避免服务器被扫描到滥用，command建议添加<code>-k _</code>参数，强制开启验证key。KEY对应文件为<code>/root/rust_hbbs/id_ed25519.pub</code>和<code>/root/rust_hbbs/id_ed25519</code>。rust客户端填写的KEY使用公钥文件内容即可<code>id_ed25519.pub</code>。</li><li>hbbs中，<code>command: hbbs -r</code>参数可以指定其他中继服务器（例如hbbr部署在另外一台服务器），就是：<code>command: hbbs -r rustdesk.example.com:21117</code>。如果服务器是具有公网IP的，直接将<code>rustdesk.example.com</code>改为服务器IP地址即可。如果是使用<code>host</code>网络模式，也可以指定<code>localhost:21117</code>。如果服务器带宽有限紧张，则不推荐开这个参数。让rustdesk默认走p2p就好，无法连接成功时，再填写relay服务器地址。</li><li>如果docker宿主机配置较差，推荐使用<code>host</code>宿主机网络版，这样没有网络隔离，适用于需要高性能网络通信的场景。官方教程也是用的<code>network_mode: &quot;host&quot;</code>。</li></ul></div><h3 id="host宿主机网络版：">5.3.1 &nbsp&nbsp<a href="#host宿主机网络版：" class="headerlink" title="host宿主机网络版："></a><code>host</code>宿主机网络版：</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hbbs:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbs</span> <span class="string">-k</span> <span class="string">_</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/rd_data:/root</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  <span class="attr">hbbr:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbr</span> <span class="string">-k</span> <span class="string">_</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/rd_data:/root</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><h3 id="rustdesk-net隔离网络版：">5.3.2 &nbsp&nbsp<a href="#rustdesk-net隔离网络版：" class="headerlink" title="rustdesk-net隔离网络版："></a><code>rustdesk-net</code>隔离网络版：</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">rustdesk-net:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">hbbs:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbs</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbs</span> <span class="string">-k</span> <span class="string">_</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/rd_data:/root</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21115</span><span class="string">:21115</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21116</span><span class="string">:21116</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21116</span><span class="string">:21116/udp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21118</span><span class="string">:21118</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rustdesk-net</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  <span class="attr">hbbr:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hbbr</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server:latest</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">hbbr</span> <span class="string">-k</span> <span class="string">_</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/rd_data:/root</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21117</span><span class="string">:21117</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21119</span><span class="string">:21119</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">rustdesk-net</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><h1 id="Docker部署WAKE-ON-LAN-WOL">6 &nbsp&nbsp<a href="#Docker部署WAKE-ON-LAN-WOL" class="headerlink" title="Docker部署WAKE-ON-LAN(WOL)"></a>Docker部署WAKE-ON-LAN(WOL)</h1><p>技术方案一栏：</p><ul><li><code>ghcr.io/trugamr/wol</code>镜像：提供WAKE-ON-LAN的基础功能</li><li><code>traefik</code>镜像：提供WAKE-ON-LAN的web管理界面的反代服务，并提供帐号验证服务。因为<code>ghcr.io/trugamr/wol</code>的WEB管理界面没有帐号验证功能。反代思路：<code>traefik</code>的入口端口为7777，然后经过docker默认网桥地址<code>172.17.0.1</code>访问<code>wol</code>的7778端口。</li></ul><p>使用<code>htpasswd</code>生成密码hash步骤：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt install apache2-utils -y</span><br><span class="line">htpasswd -nb admin yourpassword</span><br><span class="line"><span class="comment"># 输出如下哈希串，注意如果要填写到docker-compose.yml文件中，需要用$$替换$符号。</span></span><br><span class="line"><span class="comment"># 但如果是要填写到traefik的动态配置文件中，例如/root/traefik-dynamic/routers.yml，则不需要用$$替换$符号，traefik能直接读取识别的。</span></span><br><span class="line">admin:$apr1$YkxGZpGz<span class="variable">$JyV8pyiwmryBZLO9uh8KW</span>/</span><br></pre></td></tr></table></figure><p>docker-compose.yml文件内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">wol:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/trugamr/wol:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">wol</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">serve</span> <span class="comment"># To start the web interface</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">WOL_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        machines:</span></span><br><span class="line"><span class="string">          - name: desktop</span></span><br><span class="line"><span class="string">            mac: AA:BB:CC:DD:EE:FF</span></span><br><span class="line"><span class="string">            ip: 192.168.1.10 # Optional, for status checking</span></span><br><span class="line"><span class="string">        server:</span></span><br><span class="line"><span class="string">          # Listen only on the bridge network</span></span><br><span class="line"><span class="string">          listen: 172.17.0.1:7778 # Optional, defaults to :7777</span></span><br><span class="line"><span class="string">        ping:</span></span><br><span class="line"><span class="string">          privileged: true # Optional, set to true if you need privileged ping</span></span><br><span class="line"><span class="string"></span>    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">traefik.enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># Match every host and path</span></span><br><span class="line">      <span class="comment"># https://doc.traefik.io/traefik/routing/routers/#rule</span></span><br><span class="line">      <span class="attr">traefik.http.routers.wol.rule:</span> <span class="string">PathPrefix(`/`)</span></span><br><span class="line">      <span class="attr">traefik.http.routers.wol.entrypoints:</span> <span class="string">web</span></span><br><span class="line">      <span class="comment"># Create and add basic auth middleware</span></span><br><span class="line">      <span class="comment"># Generate credentials using `htpasswd -nb username password`#</span></span><br><span class="line">      <span class="comment"># <span class="doctag">Note:</span> Escaping $ in password with $$ maybe required</span></span><br><span class="line">      <span class="attr">traefik.http.middlewares.auth.basicauth.users:</span> <span class="string">admin:$$apr1$$YkxGZpGz$$JyV8pyiwmryBZLO9uh8KW/</span></span><br><span class="line">      <span class="attr">traefik.http.routers.wol.middlewares:</span> <span class="string">auth</span></span><br><span class="line">      <span class="attr">traefik.http.services.wol.loadbalancer.server.port:</span> <span class="number">7778</span></span><br><span class="line">  <span class="attr">traefik:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">traefik:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">traefik</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--providers.docker=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--providers.docker.exposedbydefault=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">--entrypoints.web.address=:7777</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7777</span><span class="string">:7777</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock:ro</span></span><br><span class="line">    <span class="attr">extra_hosts:</span></span><br><span class="line">      <span class="comment"># Map host.docker.internal to bridge network</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">host.docker.internal:172.17.0.1</span></span><br></pre></td></tr></table></figure><h1 id="Docker部署code-server（VS-Code-in-The-Browser）">7 &nbsp&nbsp<a href="#Docker部署code-server（VS-Code-in-The-Browser）" class="headerlink" title="Docker部署code-server（VS Code in The Browser）"></a>Docker部署code-server（VS Code in The Browser）</h1><div class="note danger no-icon"><ul><li>有帖子反馈打开较大的文件时，会比较卡顿。</li><li>并且插件扩展的提供渠道，也是社区维护的，但可以通过修改配置文件实现替换插件源地址为MS版本。</li></ul></div><ul><li><a href="https://hub.docker.com/r/codercom/code-server">codercom&#x2F;code-server</a>：由Coder公司开发并维护的基于微软开源的Visual Studio Code (VS Code)构建的网页版开发环</li><li><a href="https://hub.docker.com/r/linuxserver/code-server">linuxserver&#x2F;code-server</a>：基于codercom&#x2F;code-server的Docker容器化封装，支持多平台架构（x86-64&#x2F;arm64）<ul><li>LinuxServer.io镜像依赖Coder的底层更新，因此功能迭代略滞后于官方。Coder镜像是LinuxServer.io镜像的上游版本。</li></ul></li></ul><div class="note "><p>关于哈希密码的生成：</p><ol><li>在其他有装npm的机器上安装<code>argon2-cli</code>包：<code>npm install argon2-cli</code></li><li>生成哈希密码：echo -n &quot;your-password&quot; | npx argon2-cli -e</li><li>程序输出哈希（<strong>这整串就是哈希，但是填入docker-compose.yml文件中时，需要用<code>$$</code>替换<code>$</code>符号</strong>）：<code>$argon2i$v=19$m=4096,t=3,p=1$52d7tDyHRAFyqt+1k4fJsA$NvGfhHZ084v4rwGYTspIxP0uFX4qfeFRCVhsvKqN52E</code></li></ol></div><p>docker-compose.yml文件内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">code-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">codercom/code-server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">code-server</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span> <span class="comment">#时区</span></span><br><span class="line">      <span class="comment">#- PASSWORD=password #可选，改成你自己的密码 PASSWORD/HASHED_PASSWORD 至少要配置一个</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">HASHED_PASSWORD=$$argon2i$$v=19$$m=4096,t=3,p=1$$52d7tDyHRAFyqt+1k4fJsA$$NvGfhHZ084v4rwGYTspIxP0uFX4qfeFRCVhsvKqN52E</span> <span class="comment">#可选，非明文保存的密码，因为上面 Password 的[&gt;      #- SUDO_PASSWORD=password #可选，如果用这里的密码会以 sudo 的方式登陆</span></span><br><span class="line">      <span class="comment">#- SUDO_PASSWORD_HASH= #可选，同上</span></span><br><span class="line">      <span class="comment">#- PROXY_DOMAIN=code-server.my.domain #可选，服务器绑定的域名</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DEFAULT_WORKSPACE=/home/coder/project</span> <span class="comment">#可选，默认工作区</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/code-server-config:/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/code-server-workspace:/home/coder/project</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><p>访问网页管理后台：<a href="http://10.10.10.9:8080/">http://10.10.10.9:8080</a></p><h1 id="Docker搭建Gitea">8 &nbsp&nbsp<a href="#Docker搭建Gitea" class="headerlink" title="Docker搭建Gitea"></a>Docker搭建Gitea</h1><h2 id="创建Gitea的mysql数据库数据文件夹">8.1 &nbsp&nbsp<a href="#创建Gitea的mysql数据库数据文件夹" class="headerlink" title="创建Gitea的mysql数据库数据文件夹"></a>创建Gitea的mysql数据库数据文件夹</h2><p>在<code>root</code>账户路径下，创建<code>mysql</code>文件夹和子目录：<code>mkdir -p /root/mysql/conf.d</code></p><p>创建<code>my.ini</code>：<code>nano /root/mysql/conf.d/my.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### [client]配置模块 ######</span></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment">###### [mysql]配置模块 ######</span></span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># 设置MySQL客户端默认字符集</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8mb4</span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment">###### [mysqld]配置模块 ######</span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">user</span>=mysql</span><br><span class="line"><span class="comment"># 设置sql模式 sql_mode模式引起的分组查询出现*this is incompatible with sql_mode=only_full_group_by，这里最好剔除ONLY_FULL_GROUP_BY</span></span><br><span class="line"><span class="attr">sql_mode</span>=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br><span class="line"><span class="attr">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="attr">server-id</span>= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL8 的密码认证插件 如果不设置低版本navicat无法连接</span></span><br><span class="line"><span class="comment">#default_authentication_plugin=mysql_native_password</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用符号链接以防止各种安全风险</span></span><br><span class="line"><span class="attr">symbolic-links</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许最大连接数</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端使用的字符集默认为8比特编码的latin1字符集</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库字符集对应一些排序等规则，注意要和 character-set-server 对应</span></span><br><span class="line"><span class="attr">collation-server</span> = utf8mb4_unicode_ci</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建新表时将使用的默认存储引擎</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0: 表名将按指定方式存储，并且比较区分大小写;</span></span><br><span class="line"><span class="comment"># 1: 表名以小写形式存储在磁盘上，比较不区分大小写；</span></span><br><span class="line"><span class="attr">lower_case_table_names</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">max_allowed_packet</span>=<span class="number">16</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置时区</span></span><br><span class="line"><span class="attr">default-time_zone</span>=<span class="string">&#x27;+8:00&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="创建Gitea数据文件夹和配置文件">8.2 &nbsp&nbsp<a href="#创建Gitea数据文件夹和配置文件" class="headerlink" title="创建Gitea数据文件夹和配置文件"></a>创建Gitea数据文件夹和配置文件</h2><p>在<code>root</code>账户路径下，创建<code>gitea</code>文件夹和子目录：<code>mkdir -p /root/gitea/gitea/conf</code></p><p>创建<code>app.ini</code>文件：<code>nano /root/gitea/gitea/conf/app.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">APP_NAME</span> = Gitea: Git with a cup of tea</span><br><span class="line"><span class="attr">RUN_MODE</span> = prod</span><br><span class="line"><span class="attr">WORK_PATH</span> = /data/gitea</span><br><span class="line"></span><br><span class="line"><span class="section">[repository]</span></span><br><span class="line"><span class="attr">ROOT</span> = /data/git/repositories</span><br><span class="line"></span><br><span class="line"><span class="section">[repository.local]</span></span><br><span class="line"><span class="attr">LOCAL_COPY_PATH</span> = /data/gitea/tmp/local-repo</span><br><span class="line"></span><br><span class="line"><span class="section">[repository.upload]</span></span><br><span class="line"><span class="attr">TEMP_PATH</span> = /data/gitea/uploads</span><br><span class="line"></span><br><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="attr">APP_DATA_PATH</span> = /data/gitea</span><br><span class="line"><span class="attr">DOMAIN</span> = localhost</span><br><span class="line"><span class="attr">SSH_DOMAIN</span> = localhost</span><br><span class="line"><span class="attr">HTTP_PORT</span> = <span class="number">3000</span></span><br><span class="line"><span class="attr">ROOT_URL</span> = http://<span class="number">192.168</span>.<span class="number">1.10</span>:<span class="number">3000</span>/</span><br><span class="line"><span class="attr">DISABLE_SSH</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">SSH_PORT</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">SSH_LISTEN_PORT</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">LFS_START_SERVER</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">LFS_JWT_SECRET</span> =</span><br><span class="line"><span class="attr">OFFLINE_MODE</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[database]</span></span><br><span class="line"><span class="attr">PATH</span> = /data/gitea/gitea.db</span><br><span class="line"><span class="attr">DB_TYPE</span> = mysql</span><br><span class="line"><span class="attr">HOST</span> = database:<span class="number">3306</span></span><br><span class="line"><span class="attr">NAME</span> = gitea</span><br><span class="line"><span class="attr">USER</span> = gitea</span><br><span class="line"><span class="attr">PASSWD</span> = normalpdxxx</span><br><span class="line"><span class="attr">LOG_SQL</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">SSL_MODE</span> = disable</span><br><span class="line"></span><br><span class="line"><span class="section">[mailer]</span></span><br><span class="line"><span class="attr">ENABLED</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[openid]</span></span><br><span class="line"><span class="attr">ENABLE_OPENID_SIGNIN</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">ENABLE_OPENID_SIGNUP</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[cron.update_checker]</span></span><br><span class="line"><span class="attr">ENABLED</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="section">[indexer]</span></span><br><span class="line"><span class="attr">ISSUE_INDEXER_PATH</span> = /data/gitea/indexers/issues.bleve</span><br><span class="line"></span><br><span class="line"><span class="section">[session]</span></span><br><span class="line"><span class="attr">PROVIDER_CONFIG</span> = /data/gitea/sessions</span><br><span class="line"></span><br><span class="line"><span class="section">[picture]</span></span><br><span class="line"><span class="attr">AVATAR_UPLOAD_PATH</span> = /data/gitea/avatars</span><br><span class="line"><span class="attr">REPOSITORY_AVATAR_UPLOAD_PATH</span> = /data/gitea/repo-avatars</span><br><span class="line"></span><br><span class="line"><span class="section">[attachment]</span></span><br><span class="line"><span class="attr">PATH</span> = /data/gitea/attachments</span><br><span class="line"></span><br><span class="line"><span class="section">[log]</span></span><br><span class="line"><span class="attr">MODE</span> = console</span><br><span class="line"><span class="attr">LEVEL</span> = info</span><br><span class="line"><span class="attr">ROOT_PATH</span> = /data/gitea/log</span><br><span class="line"></span><br><span class="line"><span class="section">[security]</span></span><br><span class="line"><span class="attr">INSTALL_LOCK</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">INTERNAL_TOKEN</span> =</span><br><span class="line"><span class="attr">PASSWORD_HASH_ALGO</span> = pbkdf2</span><br><span class="line"><span class="attr">SECRET_KEY</span> =</span><br><span class="line"><span class="attr">REVERSE_PROXY_LIMIT</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">REVERSE_PROXY_TRUSTED_PROXIES</span> = *</span><br><span class="line"></span><br><span class="line"><span class="section">[service]</span></span><br><span class="line"><span class="attr">REGISTER_EMAIL_CONFIRM</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">ENABLE_NOTIFY_MAIL</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">DISABLE_REGISTRATION</span> = <span class="literal">true</span> <span class="comment"># 私有部署并穿透到公网的话，建议禁止自助注册新用户，避免被恶意注册当CDN用</span></span><br><span class="line"><span class="attr">ALLOW_ONLY_EXTERNAL_REGISTRATION</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">ENABLE_CAPTCHA</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">REQUIRE_SIGNIN_VIEW</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">DEFAULT_KEEP_EMAIL_PRIVATE</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">DEFAULT_ALLOW_CREATE_ORGANIZATION</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">DEFAULT_ENABLE_TIMETRACKING</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">NO_REPLY_ADDRESS</span> = noreply.localhost</span><br><span class="line"></span><br><span class="line"><span class="section">[lfs]</span></span><br><span class="line"><span class="attr">PATH</span> = /data/git/lfs</span><br><span class="line"></span><br><span class="line"><span class="section">[repository.pull-request]</span></span><br><span class="line"><span class="attr">DEFAULT_MERGE_STYLE</span> = merge</span><br><span class="line"></span><br><span class="line"><span class="section">[repository.signing]</span></span><br><span class="line"><span class="attr">DEFAULT_TRUST_MODEL</span> = committer</span><br><span class="line"></span><br><span class="line"><span class="section">[oauth2]</span></span><br><span class="line">JWT_SECRET =</span><br></pre></td></tr></table></figure><h2 id="创建actions-runner配置文件">8.3 &nbsp&nbsp<a href="#创建actions-runner配置文件" class="headerlink" title="创建actions_runner配置文件"></a>创建actions_runner配置文件</h2><div class="note danger no-icon"><p>如果是本地搭建并只在本地使用，配件文件的<code>host</code>设置为<code>127.0.0.1</code>就能访问到gitea实例了。</p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /root/actions_runner_config.yaml</span><br></pre></td></tr></table></figure><p><code>actions_runner_config.yaml</code>内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example configuration file, it&#x27;s safe to copy this as the default config file without any modification.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You don&#x27;t have to copy this file to your instance,</span></span><br><span class="line"><span class="comment"># just run `./act_runner generate-config &gt; config.yaml` to generate a config file.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">  <span class="comment"># The level of logging, can be trace, debug, info, warn, error, fatal</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line"><span class="attr">runner:</span></span><br><span class="line">  <span class="comment"># Where to store the registration result.</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">.runner</span></span><br><span class="line">  <span class="comment"># Execute how many tasks concurrently at the same time.</span></span><br><span class="line">  <span class="attr">capacity:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># Extra environment variables to run jobs.</span></span><br><span class="line">  <span class="attr">envs:</span></span><br><span class="line">    <span class="attr">A_TEST_ENV_NAME_1:</span> <span class="string">a_test_env_value_1</span></span><br><span class="line">    <span class="attr">A_TEST_ENV_NAME_2:</span> <span class="string">a_test_env_value_2</span></span><br><span class="line">  <span class="comment"># Extra environment variables to run jobs from a file.</span></span><br><span class="line">  <span class="comment"># It will be ignored if it&#x27;s empty or the file doesn&#x27;t exist.</span></span><br><span class="line">  <span class="attr">env_file:</span> <span class="string">.env</span></span><br><span class="line">  <span class="comment"># The timeout for a job to be finished.</span></span><br><span class="line">  <span class="comment"># Please note that the Gitea instance also has a timeout (3h by default) for the job.</span></span><br><span class="line">  <span class="comment"># So the job could be stopped by the Gitea instance if it&#x27;s timeout is shorter than this.</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="string">3h</span></span><br><span class="line">  <span class="comment"># Whether skip verifying the TLS certificate of the Gitea instance.</span></span><br><span class="line">  <span class="attr">insecure:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># The timeout for fetching the job from the Gitea instance.</span></span><br><span class="line">  <span class="attr">fetch_timeout:</span> <span class="string">5s</span></span><br><span class="line">  <span class="comment"># The interval for fetching the job from the Gitea instance.</span></span><br><span class="line">  <span class="attr">fetch_interval:</span> <span class="string">2s</span></span><br><span class="line">  <span class="comment"># The labels of a runner are used to determine which jobs the runner can run, and how to run them.</span></span><br><span class="line">  <span class="comment"># Like: &quot;macos-arm64:host&quot; or &quot;ubuntu-latest:docker://gitea/runner-images:ubuntu-latest&quot;</span></span><br><span class="line">  <span class="comment"># Find more images provided by Gitea at https://gitea.com/gitea/runner-images .</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty when registering, it will ask for inputting labels.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty when execute `daemon`, will use labels in `.runner` file.</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;ubuntu-latest:docker://gitea/runner-images:ubuntu-latest&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;ubuntu-22.04:docker://gitea/runner-images:ubuntu-22.04&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;ubuntu-20.04:docker://gitea/runner-images:ubuntu-20.04&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="comment"># Enable cache server to use actions/cache.</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># The directory to store the cache data.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty, the cache data will be stored in $HOME/.cache/actcache.</span></span><br><span class="line">  <span class="attr">dir:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># The host of the cache server.</span></span><br><span class="line">  <span class="comment"># It&#x27;s not for the address to listen, but the address to connect from job containers.</span></span><br><span class="line">  <span class="comment"># So 0.0.0.0 is a bad choice, leave it empty to detect automatically.</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">&quot;10.10.10.10&quot;</span></span><br><span class="line">  <span class="comment"># The port of the cache server.</span></span><br><span class="line">  <span class="comment"># 0 means to use a random available port.</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18088</span></span><br><span class="line">  <span class="comment"># The external cache server URL. Valid only when enable is true.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s specified, act_runner will use this URL as the ACTIONS_CACHE_URL rather than start a server by itself.</span></span><br><span class="line">  <span class="comment"># The URL should generally end with &quot;/&quot;.</span></span><br><span class="line">  <span class="attr">external_server:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">container:</span></span><br><span class="line">  <span class="comment"># Specifies the network to which the container will connect.</span></span><br><span class="line">  <span class="comment"># Could be host, bridge or the name of a custom network.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty, act_runner will create a network automatically.</span></span><br><span class="line">  <span class="attr">network:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># Whether to use privileged mode or not when launching task containers (privileged mode is required for Docker-in-Docker).</span></span><br><span class="line">  <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># And other options to be used when the container is started (eg, --add-host=my.gitea.url:host-gateway).</span></span><br><span class="line">  <span class="attr">options:</span></span><br><span class="line">  <span class="comment"># The parent directory of a job&#x27;s working directory.</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> There is no need to add the first &#x27;/&#x27; of the path as act_runner will add it automatically.</span></span><br><span class="line">  <span class="comment"># If the path starts with &#x27;/&#x27;, the &#x27;/&#x27; will be trimmed.</span></span><br><span class="line">  <span class="comment"># For example, if the parent directory is /path/to/my/dir, workdir_parent should be path/to/my/dir</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty, /workspace will be used.</span></span><br><span class="line">  <span class="attr">workdir_parent:</span></span><br><span class="line">  <span class="comment"># Volumes (including bind mounts) can be mounted to containers. Glob syntax is supported, see https://github.com/gobwas/glob</span></span><br><span class="line">  <span class="comment"># You can specify multiple volumes. If the sequence is empty, no volumes can be mounted.</span></span><br><span class="line">  <span class="comment"># For example, if you only allow containers to mount the `data` volume and all the json files in `/src`, you should change the config to:</span></span><br><span class="line">  <span class="comment"># valid_volumes:</span></span><br><span class="line">  <span class="comment">#   - data</span></span><br><span class="line">  <span class="comment">#   - /src/*.json</span></span><br><span class="line">  <span class="comment"># If you want to allow any volume, please use the following configuration:</span></span><br><span class="line">  <span class="comment"># valid_volumes:</span></span><br><span class="line">  <span class="comment">#   - &#x27;**&#x27;</span></span><br><span class="line">  <span class="attr">valid_volumes:</span> []</span><br><span class="line">  <span class="comment"># overrides the docker client host with the specified one.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty, act_runner will find an available docker host automatically.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s &quot;-&quot;, act_runner will find an available docker host automatically, but the docker host won&#x27;t be mounted to the job containers and service containers.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s not empty or &quot;-&quot;, the specified docker host will be used. An error will be returned if it doesn&#x27;t work.</span></span><br><span class="line">  <span class="attr">docker_host:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># Pull docker image(s) even if already present</span></span><br><span class="line">  <span class="attr">force_pull:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Rebuild docker image(s) even if already present</span></span><br><span class="line">  <span class="attr">force_rebuild:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">host:</span></span><br><span class="line">  <span class="comment"># The parent directory of a job&#x27;s working directory.</span></span><br><span class="line">  <span class="comment"># If it&#x27;s empty, $HOME/.cache/act/ will be used.</span></span><br><span class="line">  <span class="attr">workdir_parent:</span></span><br></pre></td></tr></table></figure><h2 id="启动Docker-Compose">8.4 &nbsp&nbsp<a href="#启动Docker-Compose" class="headerlink" title="启动Docker-Compose"></a>启动Docker-Compose</h2><div class="note danger no-icon"><p><code>runner</code>容器的环境变量<code>environment</code>的Gitea实例地址<code>GITEA_INSTANCE_URL</code>参数这里，不能用<code>http://server</code>直接作为参数。虽然docker compose容器之间可以识别这个写法，但<code>action runner</code>运行时无法识别该参数，使用<code>checkout</code>脚本甚至都拉取不了源码到<code>runner</code>容器内。</p><p>但参数设置错误也会导致如下错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level=error msg=<span class="string">&quot;Cannot ping the Gitea instance server&quot;</span> error=<span class="string">&quot;unknown: 500 Internal Server Error&quot;</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">level=error msg=<span class="string">&quot;Cannot ping the Gitea instance server&quot;</span> error=<span class="string">&quot;unavailable: dial tcp: lookup server on 127.0.0.11:53: server misbehaving&quot;</span></span><br></pre></td></tr></table></figure></div><div class="note danger no-icon"><p><code>runner</code>容器的环境变量<code>environment</code>的runner注册令牌<code>GITEA_RUNNER_REGISTRATION_TOKEN</code>参数步骤：在Gitea管理后台-&gt;Actions-&gt;Runners-&gt;创建Runner-&gt;创建新的令牌或者查看已有的令牌。</p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nano /root/docker-compose.yml</span><br><span class="line">docker compose -f docker-compose.yml up -d</span><br></pre></td></tr></table></figure><p><code>docker-compose.yml</code>内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">gitea:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/gitea:nightly</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_UID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">USER_GID=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__DB_TYPE=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__HOST=database:3306</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__NAME=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__USER=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA__database__PASSWD=normalpdxxx</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/gitea:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;222:22&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">database</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">database:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=rootpdxxx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=gitea</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=normalpdxxx</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="comment"># 映射目录，宿主机:容器</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/mysql/data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/mysql/conf.d:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="comment"># 让容器的时钟与宿主机时钟同步，避免时间的问题，ro是read only的意思，就是只读。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">runner:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">gitea/act_runner:nightly</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">runner</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18088:18088&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CONFIG_FILE=/config.yaml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA_INSTANCE_URL=http://10.10.10.10:3000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GITEA_RUNNER_REGISTRATION_TOKEN=xxx_token</span></span><br><span class="line">      <span class="comment">#- GITEA_RUNNER_NAME=$&#123;RUNNER_NAME&#125; # 若不需要设置名称和标签，注释即可</span></span><br><span class="line">      <span class="comment">#- GITEA_RUNNER_LABELS=$&#123;RUNNER_LABELS&#125;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">gitea</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/actions_runner_config.yaml:/config.yaml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/actions_runner:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/root/actions_runner_cache:/root/.cache</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">server</span></span><br></pre></td></tr></table></figure><h2 id="迁移Gitea的mysql数据库和git仓库数据">8.5 &nbsp&nbsp<a href="#迁移Gitea的mysql数据库和git仓库数据" class="headerlink" title="迁移Gitea的mysql数据库和git仓库数据"></a>迁移Gitea的mysql数据库和git仓库数据</h2><ol><li>备份其他服务器上的Gitea的mysql数据库、git仓库数据和gitea其他资产数据。</li><li>进入mysql容器，并使用备份sql文件恢复mysql数据库。</li><li>停止docker-compose</li><li>迁移Gitea的git仓库数据和其他资产数据（例如avatars，actions_logs等），<ul><li>Git仓库数据路径：<code>/root/gitea/git/repositories</code></li><li>Git仓库lfs数据路径：<code>/root/gitea/git/lfs</code></li><li>Gitea资产数据路径：<ul><li><code>/root/gitea/gitea/attachments</code></li><li><code>/root/gitea/gitea/repo-archive</code></li><li><code>/root/gitea/gitea/actions_logs</code></li><li><code>/root/gitea/gitea/conf</code></li><li><code>/root/gitea/gitea/actions_artifacts</code></li><li><code>/root/gitea/gitea/jwt</code></li><li><code>/root/gitea/gitea/indexers</code></li><li><code>/root/gitea/gitea/tmp</code></li><li><code>/root/gitea/gitea/repo-avatars</code></li><li><code>/root/gitea/gitea/queues</code></li><li><code>/root/gitea/gitea/packages</code></li><li><code>/root/gitea/gitea/home</code></li><li><code>/root/gitea/gitea/avatars</code></li><li><code>/root/gitea/gitea/log</code></li></ul></li></ul></li><li>重新运行docker-compose</li></ol><h2 id="Gitea搭建和使用的踩坑">8.6 &nbsp&nbsp<a href="#Gitea搭建和使用的踩坑" class="headerlink" title="Gitea搭建和使用的踩坑"></a>Gitea搭建和使用的踩坑</h2><h3 id="actions-runner容器无法正常启动，日志提示未注册runner">8.6.1 &nbsp&nbsp<a href="#actions-runner容器无法正常启动，日志提示未注册runner" class="headerlink" title="actions_runner容器无法正常启动，日志提示未注册runner"></a>actions_runner容器无法正常启动，日志提示未注册runner</h3><p>问题现象：<code>docker logs runner</code>查看日志提示如下，同时，gitea管理后台查看runner也无法看到有正常在线的runner。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level=error msg=<span class="string">&quot;fail to invoke Declare&quot;</span> error=<span class="string">&quot;unknown: rpc error: code = Unauthenticated desc = unregistered runner&quot;</span></span><br><span class="line">Error: Unknown: rpc error: code = Unauthenticated desc = unregistered runner</span><br></pre></td></tr></table></figure><p>问题原因：<code>/root/actions_runner</code>路径下有一个隐藏文件夹<code>.runner</code>，该文件夹存储runner配置数据，但该数据是旧的，gitea实例无法识别，因此runner容器无法成功注册。</p><p>解决方法：</p><ol><li>停止docker-compose</li><li>删除<code>.runner</code>文件夹：<code>rm -rf /root/actions_runner/.runner</code></li><li>重新运行docker-compose</li><li>之后在gitea管理后台就能看到正常在线的新runner了</li></ol><h3 id="“版本发布”下，自己上传的文件url错误">8.6.2 &nbsp&nbsp<a href="#“版本发布”下，自己上传的文件url错误" class="headerlink" title="“版本发布”下，自己上传的文件url错误"></a>“版本发布”下，自己上传的文件url错误</h3><blockquote><p>背景说明：Gitea构建在子局域网IP<code>10.10.10.10</code>，然后外部网络访问该Gitea服务是通过IP<code>192.168.1.10</code>（宿主机IP<code>192.168.1.10</code>已设置路由表转发<code>3000</code>端口到IP<code>10.10.10.10</code>，即<code>192.168.1.10:3000</code>-&gt;<code>10.10.10.10:3000</code>）</p></blockquote><p>问题现象：在版本发布内容中，上传的资产文件<code>assets</code>下载路径链接指向<code>http://10.10.10.10:3000/xxx.zip</code>。</p><p>问题原因：Gitea的配置文件<code>app.ini</code>中的<code>ROOT_URL</code>未设置参数，导致下载路径链接自动指向<code>http://10.10.10.10:3000/xxx</code>。</p><p>解决方法：编辑<code>app.ini</code>文件，将<code>[server]</code>小节中的<code>ROOT_URL</code>参数设置为<code>http://192.168.1.10:3000</code>即可。</p><h3 id="Gitea管理后台提示当前访问的url和app-ini配置url不同">8.6.3 &nbsp&nbsp<a href="#Gitea管理后台提示当前访问的url和app-ini配置url不同" class="headerlink" title="Gitea管理后台提示当前访问的url和app.ini配置url不同"></a>Gitea管理后台提示当前访问的url和app.ini配置url不同</h3><p>问题现象：Gitea管理后台提示警告，你的<code>app.ini</code>的<code>ROOT_URL</code>是<code>http://10.10.10.10:3000</code>，但当前访问的url是<code>http://192.168.1.10:3000</code>。你应该正确设置<code>ROOT_URL</code>，否则网络服务可能无法正常运行。</p><p>问题原因：Gitea的配置文件<code>app.ini</code>中的<code>ROOT_URL</code>未设置参数或者设置错误的url，导致下载路径链接自动指向<code>http://10.10.10.10:3000/xxx</code>。</p><p>解决方法：编辑<code>app.ini</code>文件，将<code>[server]</code>小节中的<code>ROOT_URL</code>参数设置为当前访问URL即可，例如<code>http://192.168.1.10:3000</code>。</p><h1 id="Docker搭建Redis">9 &nbsp&nbsp<a href="#Docker搭建Redis" class="headerlink" title="Docker搭建Redis"></a>Docker搭建Redis</h1><h2 id="Redis容器清理缓存">9.1 &nbsp&nbsp<a href="#Redis容器清理缓存" class="headerlink" title="Redis容器清理缓存"></a>Redis容器清理缓存</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过可交互终端进入redis容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it redis /bin/bash</span><br><span class="line"><span class="comment"># 登录容器的redis服务</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379</span><br><span class="line"><span class="comment"># 若Redis设置有密码使用该命令，否则执行 keys *会报错：(error) NOAUTH Authentication required。</span></span><br><span class="line">redis-cli -h 127.0.0.1 -p 6379 -a redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有key值</span></span><br><span class="line">keys *</span><br><span class="line"><span class="comment"># 删除指定索引的值</span></span><br><span class="line">del key</span><br><span class="line"><span class="comment"># 清除当前数据库缓存</span></span><br><span class="line">flushdb</span><br><span class="line"><span class="comment"># 清除整个redis所有缓存</span></span><br><span class="line">flushall</span><br></pre></td></tr></table></figure><h1 id="Docker搭建DataEase">10 &nbsp&nbsp<a href="#Docker搭建DataEase" class="headerlink" title="Docker搭建DataEase"></a>Docker搭建DataEase</h1><p>请提前为宿主机安装好Docker以及配置好镜像源，这里不作介绍。</p><h2 id="下载DataEase部署脚本。">10.1 &nbsp&nbsp<a href="#下载DataEase部署脚本。" class="headerlink" title="下载DataEase部署脚本。"></a>下载DataEase部署脚本。</h2><p>最新的<a href="https://github.com/dataease/dataease/releases/tag/v1.18.27">DataEase V1.x</a>部署脚本并解压（本文示例为v1.18.27版本）。</p><p><code>dataease-release-v1.18.27.tar.gz</code>和<code>dataease-v1.18.27-online.tar.gz</code>这两个文件数据完全一致，随意下载，本人解压并比对过文件哈希值。</p><p>v2.x开源社区版不支持创建用户，代码层面写死只有一个admin账户，若有用户管理的需求，可以不用考虑v2.x版本或者考虑商业版的v2.x。</p><h2 id="修改配置文件install-conf">10.2 &nbsp&nbsp<a href="#修改配置文件install-conf" class="headerlink" title="修改配置文件install.conf"></a>修改配置文件<code>install.conf</code></h2><p>安装模式模式修改为<code>local</code>，端口这些自行根据需求改，如下配置文件是修改为8100。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础配置</span></span><br><span class="line"><span class="comment">## 安装目录</span></span><br><span class="line">DE_BASE=/opt</span><br><span class="line"><span class="comment">## Service 端口</span></span><br><span class="line">DE_PORT=8100</span><br><span class="line"><span class="comment">## 部署及运行模式，可选值有 local、simple、cluster，分别对应 本地模式、精简模式、集群模式</span></span><br><span class="line">DE_ENGINE_MODE=<span class="built_in">local</span></span><br><span class="line"><span class="comment">## docker 网段设置</span></span><br><span class="line">DE_DOCKER_SUBNET=172.19.0.0/16</span><br><span class="line"><span class="comment">## docker 网关 IP</span></span><br><span class="line">DE_DOCKER_GATEWAY=172.19.0.1</span><br><span class="line"><span class="comment">## Apache Doris FE IP (外部 Doris 此参数无效)</span></span><br><span class="line">DE_DORIS_FE_IP=172.19.0.198</span><br><span class="line"><span class="comment">## Apache Doris BE IP (外部 Doris 此参数无效)</span></span><br><span class="line">DE_DORIS_BE_IP=172.19.0.199</span><br><span class="line"><span class="comment">## 登录超时时间，单位min。如果不设置则默认8小时，也就是480</span></span><br><span class="line">DE_LOGIN_TIMEOUT=480</span><br><span class="line"><span class="comment">## 新建用户初始密码</span></span><br><span class="line">DE_INIT_PASSWORD=DataEase123456</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line"><span class="comment">## 是否使用外部数据库</span></span><br><span class="line">DE_EXTERNAL_MYSQL=<span class="literal">false</span></span><br><span class="line"><span class="comment">## 数据库地址</span></span><br><span class="line">DE_MYSQL_HOST=mysql</span><br><span class="line"><span class="comment">## 数据库端口</span></span><br><span class="line">DE_MYSQL_PORT=3306</span><br><span class="line"><span class="comment">## DataEase 数据库库名</span></span><br><span class="line">DE_MYSQL_DB=dataease</span><br><span class="line"><span class="comment">## 数据库用户名</span></span><br><span class="line">DE_MYSQL_USER=root</span><br><span class="line"><span class="comment">## 数据库密码</span></span><br><span class="line">DE_MYSQL_PASSWORD=Password123@mysql</span><br><span class="line"><span class="comment">## 数据库参数</span></span><br><span class="line">DE_MYSQL_PARAMS=<span class="string">&quot;autoReconnect=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache Doris 配置</span></span><br><span class="line"><span class="comment">## 是否使用外部 Apache Doris</span></span><br><span class="line">DE_EXTERNAL_DORIS=<span class="literal">false</span></span><br><span class="line"><span class="comment">## Doris 地址</span></span><br><span class="line">DE_DORIS_HOST=doris-fe</span><br><span class="line"><span class="comment">## Doris 查询连接端口</span></span><br><span class="line">DE_DORIS_PORT=9030</span><br><span class="line"><span class="comment">## Doris http端口</span></span><br><span class="line">DE_DORIS_HTTPPORT=8030</span><br><span class="line"><span class="comment">## Doris 数据库名称</span></span><br><span class="line">DE_DORIS_DB=dataease</span><br><span class="line"><span class="comment">## Doris 用户名</span></span><br><span class="line">DE_DORIS_USER=root</span><br><span class="line"><span class="comment">## Doris 密码</span></span><br><span class="line">DE_DORIS_PASSWORD=Password123@doris</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kettle 配置</span></span><br><span class="line"><span class="comment">## 是否使用外部 Kettle - (目前还不支持外部Kettle，除非不需运行Kettle，否则请不要修改此参数)</span></span><br><span class="line">DE_EXTERNAL_KETTLE=<span class="literal">false</span></span><br><span class="line"><span class="comment">## Kettle 服务器地址</span></span><br><span class="line">DE_CARTE_HOST=kettle</span><br><span class="line"><span class="comment">## Kettle 访问端口</span></span><br><span class="line">DE_CARTE_PORT=18080</span><br><span class="line"><span class="comment">## Kettle 用户名</span></span><br><span class="line">DE_CARTE_USER=cluster</span><br><span class="line"><span class="comment">## Kettle 密码</span></span><br><span class="line">DE_CARTE_PASSWORD=cluster</span><br></pre></td></tr></table></figure><h3 id="不同安装模式的区别">10.2.1 &nbsp&nbsp<a href="#不同安装模式的区别" class="headerlink" title="不同安装模式的区别"></a>不同安装模式的区别</h3><div class="note info no-icon"><p>DE_ENGINE_MODE&#x3D;local<br>使用本地模式安装，DataEase 会自带 Doris 与 Kettle 组件，无需再做额外配置，但各组件均为单点，不具备高可用特性。<br>在此模式下，Excel 数据集、API 数据集以及定时同步的数据默认保存在自带的 Doris 组件中。</p></div><div class="note info no-icon"><p>DE_ENGINE_MODE&#x3D;simple<br>使用精简模式安装，系统不会额外安装 Doris 与 Kettle 组件，提供用户轻量级的应用系统，尤其是对接数据量较小的情况。<br>在此模式下，Excel 数据集或 API 数据集的相关数据存储在数据引擎中（默认配置自带的 MySQL 组件，用户可在系统管理界面配置数据引擎，数据引擎目前仅支持 MySQL 类型）。<br>注意：由于精简模式未配置 Kettle 与 Doris，故精简模式不提供定时同步模式。</p></div><div class="note info no-icon"><p>DE_ENGINE_MODE&#x3D;cluster<br>使用集群模式安装，系统不会额外安装 Doris 与 Kettle 组件，但会在系统管理模块提供 Doris 与 Kettle 的链接配置界面（请参考【系统管理】的【系统参数】说明），用户可独立安装 Doris 集群及 Kettle 并配置在 DataEase 中。集群模式下 Excel 数据集，API 数据集以及定时同步的数据通过 Kettle 抽取到 Doris 集群中。<br>Doris 安装部署可参考：<a href="http://doris.incubator.apache.org/zh-CN/">http://doris.incubator.apache.org/zh-CN/</a><br>Kettle 安装部署可参考：<a href="http://www.kettle.org.cn/">http://www.kettle.org.cn/</a></p></div><h2 id="安装DataEase">10.3 &nbsp&nbsp<a href="#安装DataEase" class="headerlink" title="安装DataEase"></a>安装DataEase</h2><p>运行命令安装DataEase，并查看对应docker容器是否正常运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash ./install.sh</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><h2 id="创建DataEase的踩坑记录">10.4 &nbsp&nbsp<a href="#创建DataEase的踩坑记录" class="headerlink" title="创建DataEase的踩坑记录"></a>创建DataEase的踩坑记录</h2><h3 id="doris-be容器状态一直为unhealthy">10.4.1 &nbsp&nbsp<a href="#doris-be容器状态一直为unhealthy" class="headerlink" title="doris-be容器状态一直为unhealthy"></a>doris-be容器状态一直为unhealthy</h3><p>问题：doris-be容器状态一直为unhealthy，一直在尝试反复启动。<code>docker logs doris-be</code>查看到如下日志输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">doris_role:be</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; FE_SERVERS=[fe1:172.19.0.198:9010]</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; BE_ADDR=[172.19.0.199:9050]</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; feIpArray = 172.19.0.198</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; feEditLogPortArray = 9010</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; masterFe = 172.19.0.198:9010</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; be_addr = 172.19.0.199:9050</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; Append the configuration [priority_networks = 172.19.0.0/24] to /opt/apache-doris/be/conf/fe.conf</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; registerMySQL = mysql -uroot -P9030 -h172.19.0.198  -e <span class="string">&quot;alter system add backend &#x27;172.19.0.199:9050&#x27;&quot;</span></span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; registerShell = /opt/apache-doris/be/bin/start_be.sh &amp;</span><br><span class="line">mysql -uroot -P9030 -h172.19.0.198  -e <span class="string">&quot;show backends&quot;</span> | grep <span class="string">&quot; 172.19.0.199 &quot;</span> | grep <span class="string">&quot; 9050 &quot;</span></span><br><span class="line">10003   default_cluster 172.19.0.199    9050    -1      -1      -1      NULL    NULL    <span class="literal">false</span>   <span class="literal">false</span>   <span class="literal">false</span>   0       0.000   1.000 B       0.000   0.00 %  0.00 %  0.000   &#123;<span class="string">&quot;location&quot;</span> : <span class="string">&quot;default&quot;</span>&#125;        java.net.NoRouteToHostException: No route to host (Host unreachable)          &#123;<span class="string">&quot;lastStreamLoadTime&quot;</span>:-1,<span class="string">&quot;isQueryDisabled&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;isLoadDisabled&quot;</span>:<span class="literal">false</span>&#125;        1</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; The  0 <span class="keyword">time</span> to register BE node, be_join_status=0</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; run <span class="built_in">command</span> /opt/apache-doris/be/bin/start_be.sh &amp;</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; registered : 1</span><br><span class="line">Please <span class="built_in">set</span> vm.max_map_count to be 2000000 under root using <span class="string">&#x27;sysctl -w vm.max_map_count=2000000&#x27;</span>.</span><br><span class="line">ERROR 1105 (HY000) at line 1: errCode = 2, detailMessage = There is no scanNode Backend available.[10003: not alive]</span><br><span class="line">DEBUG &gt;&gt;&gt;&gt;&gt;&gt; The  1  <span class="keyword">time</span> to check is_alive &gt;&gt;&gt;&gt;&gt;&gt; 1</span><br><span class="line">ERROR 1105 (HY000) at line 1: errCode = 2, detailMessage = There is no scanNode Backend available.[10003: not alive]</span><br></pre></td></tr></table></figure><p>可以查看上述日志输出提示<code>Please set vm.max_map_count to be 2000000 under root using &#39;sysctl -w vm.max_map_count=2000000&#39;.</code></p><p>原因：Doris作为分布式数据库，对于内存映射数量有要求，Linux系统默认参数值无法满足，例如PVE系统默认的<code>vm.max_map_count=262144</code>。</p><ul><li>解决方法1：请在运行doris容器的宿主机上设置<code>vm.max_map_count</code>内核参数。若宿主机本身也是容器化的虚拟机，例如PVE的LXC容器，可以直接在PVE上运行命令修改参数。  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 持久化设定，永久生效，推荐使用该方式</span></span><br><span class="line">nano /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 在/etc/sysctl.conf最底部添加如下参数，保存文件</span></span><br><span class="line">vm.max_map_count=2000000</span><br><span class="line"><span class="comment"># 从文件中加载参数，不指定文件默认加载读取 /etc/sysctl.conf 的内容，会立即应用其中的内核参数（无需重启系统）</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时设置生效，重启PVE后会恢复到默认值，而不是2000000</span></span><br><span class="line">sysctl -w vm.max_map_count=2000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看参数值</span></span><br><span class="line">sysctl vm.max_map_count</span><br></pre></td></tr></table></figure></li><li>解决方法2：换DataEase v2版本，v2系列不需要部署Doris。</li></ul><h3 id="在DataEase添加Excel数据集后，预览数据界面无法加载，并一直提示Access-denied-for-user-root-172-19-0-4">10.4.2 &nbsp&nbsp<a href="#在DataEase添加Excel数据集后，预览数据界面无法加载，并一直提示Access-denied-for-user-root-172-19-0-4" class="headerlink" title="在DataEase添加Excel数据集后，预览数据界面无法加载，并一直提示Access denied for user &#39;root@172.19.0.4&#39;"></a>在DataEase添加Excel数据集后，预览数据界面无法加载，并一直提示<code>Access denied for user &#39;root@172.19.0.4&#39;</code></h3><p>原因：修改过<code>install.conf</code>的MySQL和Doris的密码都会导致出现该故障。据<a href="https://github.com/dataease/dataease/issues/5939">5939的issue</a>反馈该问题在1.18.23已修复，但本人使用1.18.27版本部署，修改密码仍会出现该问题。</p><p>解决方法：不修改<code>install.conf</code>的MySQL和Doris的密码，直接使用模板预设的默认密码完成部署。</p><h2 id="DataEase使用踩坑纪录（以下总结大多是基于V1版本）">10.5 &nbsp&nbsp<a href="#DataEase使用踩坑纪录（以下总结大多是基于V1版本）" class="headerlink" title="DataEase使用踩坑纪录（以下总结大多是基于V1版本）"></a>DataEase使用踩坑纪录（以下总结大多是基于V1版本）</h2><ul><li>变更&#x2F;删除数据集，均会导致丢失仪表盘的过滤器参数</li><li>使用excel作为数据集的话，替换数据集时，不能存在任何计算字段。<ul><li>若存在计算字段，替换数据操作能成功，但是导入之后预览会报错：<code>预览数据错误：执行SQL失败。可能因相关字段、表、数据集等元素发生变更，请检查-&gt;SQL ERRORerrCode = 2, detailMessage = Sql parser can&#39;t convert the result to array, please check your sql.</code></li><li>预览数据报错解决方式：复制保存计算字段代码逻辑之后，删除已有的计算字段，并重建计算字段。</li></ul></li><li>仪表盘的视图在超过1000条数据时则无法全部导出excel表格（比如实际导出的excel表格行数为1001，有一行是表头）<ul><li>原因：统计视图-&gt;编辑-&gt;数据-&gt;结果展示-&gt;默认是勾选「1000」。一开始我也被<a href="https://github.com/dataease/dataease/issues/5997">[Feature]导出功能加强</a>这个issue的回复给误导，以为1000条导出限制就是代码的硬限制。</li><li>解决方法：修改勾选为「全部」。</li><li>但复杂的筛选条件的数据导出，例如包含<code>or</code>即<code>或</code>逻辑，建议还是使用数据集的导出功能。仪表盘的视图仍无法处理复杂的筛选条件。</li></ul></li><li>excel数据源若有几万行，则无法成功导入dataease作为数据集，在数据同步阶段会失效（可能是内存溢出的问题，有待排查验证）</li><li>V2社区开源版不支持创建多用户</li><li>Dataease短链访问：手机浏览器访问提示空白模板（实测安卓火狐和ios的saffasi都遇到一样的情况）。短链解析是未能返回正确的字符串。<ul><li>解决方法：手机移动端需要指定参数——PC端网站，才能解析正常。</li></ul></li></ul><h1 id="Docker-Desktop（Windows）">11 &nbsp&nbsp<a href="#Docker-Desktop（Windows）" class="headerlink" title="Docker Desktop（Windows）"></a>Docker Desktop（Windows）</h1><h2 id="Docker-Unexpected-error">11.1 &nbsp&nbsp<a href="#Docker-Unexpected-error" class="headerlink" title="Docker Unexpected error"></a>Docker Unexpected error</h2><p>问题：无法启用Docker Desktop，提示报错<code>Docker Unexpected error</code>。</p><p>原因：之前有安装并卸载过Docker Desktop。重新安装Docker Desktop有可能触发此问题。</p><p>解决方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wsl --unregister docker-desktop</span><br><span class="line">wsl --unregister docker-desktop-data</span><br><span class="line"><span class="comment"># 运行上面两条命令，然后重新启动Docker Desktop</span></span><br></pre></td></tr></table></figure><h1 id="参考文献">12 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] Docker Unexpected error[EB&#x2F;OL]. <a href="https://github.com/docker/for-win/issues/14034">https://github.com/docker/for-win/issues/14034</a>.<br>[2] Install Docker Engine on Debian[EB&#x2F;OL]. <a href="https://docs.docker.com/engine/install/debian/#install-using-the-repository">https://docs.docker.com/engine/install/debian/#install-using-the-repository</a>.<br>[3] DockerHub 国内加速镜像列表[EB&#x2F;OL]. <a href="https://github.com/dongyubin/DockerHub">https://github.com/dongyubin/DockerHub</a>.<br>[4] Docker 容器使用[EB&#x2F;OL]. <a href="https://www.runoob.com/docker/docker-container-usage.html">https://www.runoob.com/docker/docker-container-usage.html</a>.<br>[5] [Question]配置doris数据源提示错误：Access denied for user &#39;<a href="mailto:&#114;&#x6f;&#x6f;&#x74;&#x40;&#49;&#55;&#x32;&#46;&#49;&#x39;&#46;&#48;&#x2e;&#52;">root@172.19.0.4</a>&#39; (using password: YES)[EB&#x2F;OL]. <a href="https://github.com/dataease/dataease/issues/5939">https://github.com/dataease/dataease/issues/5939</a>.<br>[6] 安装模式[EB&#x2F;OL]. <a href="https://dataease.io/docs/v1/installation/installation_mode/#11">https://dataease.io/docs/v1/installation/installation_mode/#11</a>.<br>[7] Docker Build Cache 缓存清理[EB&#x2F;OL]. <a href="https://blog.csdn.net/catoop/article/details/128002962">https://blog.csdn.net/catoop/article/details/128002962</a>.<br>[8] docker下redis容器清理缓存[EB&#x2F;OL]. <a href="https://blog.csdn.net/weixin_44662304/article/details/114694451">https://blog.csdn.net/weixin_44662304/article/details/114694451</a>.<br>[9] “版本发布”下，自己上传的文件url错误[EB&#x2F;OL]. <a href="https://forum.gitea.com/t/url/8030/1">https://forum.gitea.com/t/url/8030/1</a>.<br>[10] 反向代理[EB&#x2F;OL]. <a href="https://docs.gitea.com/zh-cn/administration/reverse-proxies">https://docs.gitea.com/zh-cn/administration/reverse-proxies</a>.<br>[11] 使用 Docker 安装[EB&#x2F;OL]. <a href="https://docs.gitea.com/zh-cn/next/installation/install-with-docker">https://docs.gitea.com/zh-cn/next/installation/install-with-docker</a>.<br>[12] Act Runner[EB&#x2F;OL]. <a href="https://docs.gitea.com/zh-cn/next/usage/actions/act-runner">https://docs.gitea.com/zh-cn/next/usage/actions/act-runner</a>.<br>[13] 备份与恢复[EB&#x2F;OL]. <a href="https://docs.gitea.com/zh-cn/next/administration/backup-and-restore">https://docs.gitea.com/zh-cn/next/administration/backup-and-restore</a>.<br>[14] 求助：Docker-compose部署act_runner出现错误[EB&#x2F;OL]. <a href="https://forum.gitea.com/t/docker-compose-act-runner/8525">https://forum.gitea.com/t/docker-compose-act-runner/8525</a>.<br>[15] Runner Will Not Register via Docker Compose[EB&#x2F;OL]. <a href="https://gitea.com/gitea/act_runner/issues/550">https://gitea.com/gitea/act_runner/issues/550</a>.<br>[16] runner: level&#x3D;error msg&#x3D;&quot;Cannot ping the Gitea instance server&quot; error&#x3D;&quot;unknown: 500 Internal Server Error&quot;[EB&#x2F;OL]. <a href="https://gitea.com/gitea/act_runner/issues/400">https://gitea.com/gitea/act_runner/issues/400</a>.<br>[17] 使用docker-compose 部署 MySQL（所有版本通用）[EB&#x2F;OL]. <a href="https://blog.csdn.net/weixin_44606481/article/details/132840940">https://blog.csdn.net/weixin_44606481/article/details/132840940</a>.<br>[18] Can I store my password hashed?[EB&#x2F;OL]. <a href="https://github.com/coder/code-server/blob/main/docs/FAQ.md#can-i-store-my-password-hashed">https://github.com/coder/code-server/blob/main/docs/FAQ.md#can-i-store-my-password-hashed</a>.<br>[19] 【学习笔记 - code-server】通过docker-compose配置code-server（一）[EB&#x2F;OL]. <a href="https://blog.csdn.net/kirigirihitomi/article/details/132859159">https://blog.csdn.net/kirigirihitomi/article/details/132859159</a>.<br>[20] 完全免费利用家宽IPV6和个人电脑搭建rustdesk-server-windows服务器实现远程控制[EB&#x2F;OL]. <a href="https://www.npspro.cn/27999.html">https://www.npspro.cn/27999.html</a>.<br>[21] docker-compose自建RustDesk远程控制服务器 [EB&#x2F;OL]. <a href="https://www.cnblogs.com/zwgbk/p/16648073.html">https://www.cnblogs.com/zwgbk/p/16648073.html</a>.<br>[22] 安装[EB&#x2F;OL]. <a href="https://rustdesk.com/docs/zh-cn/self-host/rustdesk-server-oss/install/">https://rustdesk.com/docs/zh-cn/self-host/rustdesk-server-oss/install/</a>.<br>[23] DDNS-GO[EB&#x2F;OL]. <a href="https://github.com/jeessy2/ddns-go">https://github.com/jeessy2/ddns-go</a>.<br>[24] wol&#x2F;examples&#x2F;reverse-proxy.yml[EB&#x2F;OL]. <a href="https://github.com/Trugamr/wol/blob/main/examples/reverse-proxy.yml">https://github.com/Trugamr/wol/blob/main/examples/reverse-proxy.yml</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.runoob.com/docker/docker-resources.html&quot;&gt;Docker 命令大全&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;docker的基础命令操作&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a</summary>
        
      
    
    
    
    <category term="code" scheme="https://mister-kin.github.io/categories/code/"/>
    
    
  </entry>
  
  <entry>
    <title>日常生活</title>
    <link href="https://mister-kin.github.io/daily-life/"/>
    <id>https://mister-kin.github.io/daily-life/</id>
    <published>2024-05-12T14:12:02.000Z</published>
    <updated>2025-05-08T17:37:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数学计算">1 &nbsp&nbsp<a href="#数学计算" class="headerlink" title="数学计算"></a>数学计算</h1><ul><li>对于指数函数来说底数不能为负数，而对于代数运算来说却可以为负数。因为n总是表示正整数,底数为负数是可以的，这个式子仍然是有限次代数运算的极限</li><li>乘除法的计算本质：计算过程中的错位相加是为了保证各行的小数点位置相同，实际就是保证各个数字的权重相同。</li></ul><h1 id="生活琐事">2 &nbsp&nbsp<a href="#生活琐事" class="headerlink" title="生活琐事"></a>生活琐事</h1><p>当花费大量时间却无法解决一个问题时，若非紧急状态，建议先将该问题放一边。等到放松或者忙完另外一件事情甚至于明天再重新去思考解决这个问题。</p><h1 id="生活记录">3 &nbsp&nbsp<a href="#生活记录" class="headerlink" title="生活记录"></a>生活记录</h1><ul><li>灭蟑螂：洗衣服+饭+白糖。</li><li>盖章：公章盖签字位置，以及骑缝章（盖边缘，确保完整章都出现在边缘）。</li><li>去打印店，一定得输出PDF再打印。</li><li>不要买大豆油，加热有腥臭味。买花生油。</li><li>湖南人fh不分，弗兰银&#x2F;湖兰人&#x2F;胡建人。</li><li>出门在外吃饭，看大货车司机。</li><li>学生票要取纸票，得刷磁条才能享受优惠，否则检票时会面临补票的问题。</li><li>四六级口语分两天，笔试一天（上午四，下午六）。</li><li>2021花呗弹窗说需上报征信。</li><li>京东白条的注销，需要下载京东金融白条&gt;设置&gt;账户安全&gt;注销白条用户&gt;继续注销，或者直接在京东金融客服，输入注销白条，可以直接跳转。</li><li>信用卡（透支信用贷款），小额消费贷款（多笔记录不利于征信）</li></ul><h1 id="医学">4 &nbsp&nbsp<a href="#医学" class="headerlink" title="医学"></a>医学</h1><ul><li>睡眠一定要规律，否则生物钟不好调整适应，会造成人体免疫力下降。</li><li>关于外伤伤口的处理：生理盐水清洗伤口即可，剩下等身体自动修复。消毒可以用碘伏。P.S.切忌使用紫药水，不仅致癌，还会形成结痂无法观察伤口。</li><li>烫伤疼痛明显：冷水冲洗30分钟。</li></ul><h2 id="药品清单">4.1 &nbsp&nbsp<a href="#药品清单" class="headerlink" title="药品清单"></a>药品清单</h2><ul><li>蚬壳胃散-海螵蛸</li><li>小柴胡冲剂</li><li>复方黄芩片-肇庆新湖制药</li><li>复方穿心莲-广州白云山和记黄埔中药</li><li>氯芬黄敏片-广州白云山明兴制药</li><li>复方氨酚烷胺片（感冒）</li><li>维C银翘片-国药集团德众（佛山）药业有限公司</li><li>腹可安片-广州白云山一药业</li><li>正露丸（喇叭丸）-大幸药品</li><li>桂林西瓜霜-桂林三金药业</li><li>冰硼散（微毒性）</li><li>维C片</li><li>维B片</li><li>盐酸小襞碱片</li><li>枸地氯雷他定片-扬子江药业集团</li><li>脾氨肽口服冻干粉</li><li>攻肤之王-广州泽上堂生物科技有限公司</li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;数学计算&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#数学计算&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    
  </entry>
  
  <entry>
    <title>FFmpeg</title>
    <link href="https://mister-kin.github.io/software/ffmpeg/"/>
    <id>https://mister-kin.github.io/software/ffmpeg/</id>
    <published>2024-05-12T12:14:21.000Z</published>
    <updated>2024-05-13T00:33:35.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基础">1 &nbsp&nbsp<a href="#基础" class="headerlink" title="基础"></a>基础</h1><p>ffmpeg -i input.avi -metadata key&#x3D;value -codec copy output.avi<br>ffprobe &quot;file&quot; #查看metadata</p><h2 id="查询命令">1.1 &nbsp&nbsp<a href="#查询命令" class="headerlink" title="查询命令"></a>查询命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg.exe -h -&gt; help.txt <span class="comment"># 打印帮助文件</span></span><br><span class="line">ffmpeg -h encoder=libx264</span><br><span class="line">ffmpeg -hwaccels <span class="comment"># 查看支持的硬件加速选项</span></span><br><span class="line">ffmpeg -codecs | grep cuvid <span class="comment"># 查看cuvid提供的GPU编解码器（grep为Linux命令）</span></span><br><span class="line">ffmpeg -f lavfi -i nullsrc -c:v nvenc -gpu list -f null none_output (-hwaccel_device N 和 -gpu N)</span><br></pre></td></tr></table></figure><h2 id="硬件编码">1.2 &nbsp&nbsp<a href="#硬件编码" class="headerlink" title="硬件编码"></a>硬件编码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-c:v h264_nvenc -rc:v vbr_hq -cq:v 19 -b:v 2500k -maxrate:v 5000k -profile:v high</span><br><span class="line">ffmpeg -hwaccel cuvid -c:v h264_cuvid -i &lt;input&gt; -c:v h264_nvenc -b:v 2048k -vf scale_npp=1280:-1 -y &lt;output&gt;</span><br><span class="line">ffmpeg -vsync 0 -hwaccel cuvid -c:v h264_cuvid -i input.mp4 -c:a copy -c:v h264_nvenc -b:v 5M output.mp4</span><br><span class="line">                -hwaccel cuda -hwaccel_output_format cuda</span><br><span class="line">ffmpeg -vsync 0 –hwaccel cuvid -c:v h264_cuvid –resize 1280x720 -i input.mp4 -c:a copy -c:v h264_nvenc -b:v 5M output.mp4</span><br><span class="line">ffmpeg -r 30 -f image2 -i %4d.jpg -r 30 -c:v h264_nvenc -profile:v high -level 5.1 -preset slow -rc:v vbr_hq -cq:v 19 -b:v 2500k -maxrate:v 5000k ../output.mp4</span><br></pre></td></tr></table></figure><h1 id="实战案例">2 &nbsp&nbsp<a href="#实战案例" class="headerlink" title="实战案例"></a>实战案例</h1><h2 id="合并多个视频文件">2.1 &nbsp&nbsp<a href="#合并多个视频文件" class="headerlink" title="合并多个视频文件"></a>合并多个视频文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f concat -i filelist.txt -c copy output.mp4</span><br><span class="line"><span class="comment"># filelist.txt</span></span><br><span class="line"><span class="comment"># file &#x27;1.flv&#x27;</span></span><br><span class="line"><span class="comment"># file &#x27;2.flv&#x27;</span></span><br><span class="line"><span class="comment"># file &#x27;3.flv&#x27;</span></span><br><span class="line"><span class="comment"># file &#x27;4.flv&#x27;</span></span><br></pre></td></tr></table></figure><h1 id="常见知识点">3 &nbsp&nbsp<a href="#常见知识点" class="headerlink" title="常见知识点"></a>常见知识点</h1><ul><li>yuv420p的p代表planar</li><li>k和K都是表示$10^3&#x2F;2^{10}$，K之后的只有大写，比如M表示$10^6&#x2F;2^{20}$（详见<a href="https://ffmpeg.org/ffmpeg-utils.html#Expression-Evaluation">Expression Evaluation</a>。</li><li>bufsize配合maxrate参数使用可控制编码时的码率波动，例如264的cbr恒定码率编码中，同时设置b:v maxrate minrate bufsize(前三个都是设置为1M，bufsize设置为50k，最后编码出来的码率波动最小996kbit&#x2F;s，1001kbit&#x2F;s)。bufsize is the &quot;rate control buffer&quot;，即码率控制缓存。作用是每次达到bufsize大小，都是计算并调整到average平均码率。</li><li>filter chain之间的filter用分号，普通的filter之间用逗号</li><li>aac编码：网络视频128k；高质量192k</li></ul><h1 id="常见错误-警告">4 &nbsp&nbsp<a href="#常见错误-警告" class="headerlink" title="常见错误&#x2F;警告"></a>常见错误&#x2F;警告</h1><h2 id="时间戳问题">4.1 &nbsp&nbsp<a href="#时间戳问题" class="headerlink" title="时间戳问题"></a>时间戳问题</h2><p>常见于 Non-monotonous DTS in output stream</p><p>完美的解决方式暂未找到，网上的解决方法基本为：先转为 mts 文件，后转为 mp4。（本质是重新编码，确实可以解决时间戳错误，但也会劣化音质和画质。）</p><h2 id="deprecated-pixel-format-used-make-sure-you-did-set-range-correctly">4.2 &nbsp&nbsp<a href="#deprecated-pixel-format-used-make-sure-you-did-set-range-correctly" class="headerlink" title="deprecated pixel format used, make sure you did set range correctly"></a>deprecated pixel format used, make sure you did set range correctly</h2><p>This is just a warning, not an error. You can safely ignore it when using ffmpeg from the command-line, and you don&#39;t have to fix anything.</p><p>The warning occurs when converting from a yuv420p source to JPEG, which makes ffmpeg choose yuvj420p as output format. That format is required for writing files with the mjpeg encoder.</p><p>These two pixel formats have different color ranges: the former is from 16–235, which is &quot;limited range&quot; (also called &quot;MPEG&quot; range), the latter defaults to 0–255, which is &quot;full range&quot;. The warning is meant for using FFmpeg as a library in your own code (like here). See also the comments on this question.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;基础&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#基础&quot; class=&quot;headerlink&quot; title=&quot;基础&quot;&gt;&lt;/a&gt;基础&lt;/h1&gt;&lt;p&gt;ffmpeg -i input.avi -metadata key&amp;#x3D;value -codec copy</summary>
        
      
    
    
    
    <category term="software" scheme="https://mister-kin.github.io/categories/software/"/>
    
    
  </entry>
  
  <entry>
    <title>Blender二次代码开发总结</title>
    <link href="https://mister-kin.github.io/software/blender/code-development/"/>
    <id>https://mister-kin.github.io/software/blender/code-development/</id>
    <published>2024-05-12T12:10:31.000Z</published>
    <updated>2025-01-01T18:15:53.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="推荐资源">1 &nbsp&nbsp<a href="#推荐资源" class="headerlink" title="推荐资源"></a>推荐资源</h1><ul><li><a href="https://b3d.interplanety.org/en/">B3D - Interplanety</a></li></ul><h1 id="开发技巧">2 &nbsp&nbsp<a href="#开发技巧" class="headerlink" title="开发技巧"></a>开发技巧</h1><ul><li>cycles API直接查看cycles源码，properties.py</li><li>blender -r -R注册blend后缀名文件，小r为静默注册-v显示版本</li><li>blender排错cmd工具：blender_debug_log.bat</li></ul><p>用户偏好设置-开发额外选项+Python工具提示+工具提示</p><p>开启「开发额外选项」后，右键UI组件，可以查看源代码。</p><p>在寻找UI组件所在类目时，可查看Python工具提示信息。</p><p>在查找一些操作命令时，可以在blender里操作后在控制台看执行的语句。活用blender控制台进行调试。</p><p>live edit状态去除bl_info（meta元数据），其余状态一样</p><p>Operator 的 bl_label 的 translation context 必须为 Operator。<br>Operator 的 bl_description 的 translation context 必须为 *。</p><p>blender主程序目录下，有debug.cmd工具可以用于生成blender崩溃的日志。</p><h1 id="常见API总结">3 &nbsp&nbsp<a href="#常见API总结" class="headerlink" title="常见API总结"></a>常见API总结</h1><ul><li>插件信息说明：<a href="https://wiki.blender.org/wiki/Process/Addons/Guidelines/metainfo#Script_Meta_Info">见info字典元素</a></li><li>bpy.types：Header, Menu, Panel, Operator。前三个都是需要定义draw函数来实现UI，Operator一般用来定义操作的execute函数。</li><li><a href="https://docs.blender.org/api/current/bpy.props.html#">Props属性</a></li><li><a href="https://docs.blender.org/api/current/bpy.types.KeyMaps.html#bpy.types.KeyMaps">KeyMaps类</a></li><li><a href="https://docs.blender.org/api/current/bpy.types.KeyMapItems.html#bpy.types.KeyMapItem">KeyMapItem类</a></li></ul><h1 id="插件升级功能">4 &nbsp&nbsp<a href="#插件升级功能" class="headerlink" title="插件升级功能"></a>插件升级功能</h1><ul><li><a href="https://theduckcow.com/2016/addon-updater-tutorial/">https://theduckcow.com/2016/addon-updater-tutorial/</a></li><li><a href="https://github.com/CGCookie/blender-addon-updater">https://github.com/CGCookie/blender-addon-updater</a></li></ul><h1 id="常见问题总结">5 &nbsp&nbsp<a href="#常见问题总结" class="headerlink" title="常见问题总结"></a>常见问题总结</h1><h2 id="调用operator出现poll-函数报错">5.1 &nbsp&nbsp<a href="#调用operator出现poll-函数报错" class="headerlink" title="调用operator出现poll()函数报错"></a>调用operator出现poll()函数报错</h2><div class="note info no-icon"><p>在Blender的插件开发中，业务逻辑功能若能避免使用bpy.ops函数就尽量避免使用，因为大量使用ops函数不仅影响性能，而且还可能引发poll函数RuntimeError异常。二次代码开发，更推荐使用Blender原生API类接口实现业务逻辑功能。</p></div><p>问题现象：RuntimeError: Operator bpy.ops.object.empty_image_add.poll() failed, context is incorrect</p><p>问题原因：Blender代码设计中，很多operator都有一个poll函数专门用于检测鼠标指针是否在一个有效的窗口区域或者检测当前物体是否在正确的模式中（例如编辑模式，权重绘制模式），如果poll函数返回失败值的话，就会引发RuntimeError异常。</p><p>解决方法：<br>context override的代码实现，如下代码适用于所有blender版本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ContextExecuterOverride</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, window, screen, area, region</span>):</span><br><span class="line">        <span class="variable language_">self</span>.window, <span class="variable language_">self</span>.screen, <span class="variable language_">self</span>.area, <span class="variable language_">self</span>.region = window, screen, area, region</span><br><span class="line">        <span class="variable language_">self</span>.legacy = <span class="keyword">not</span> <span class="built_in">hasattr</span>(bpy.context, <span class="string">&quot;temp_override&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.legacy:</span><br><span class="line">            <span class="variable language_">self</span>.context = bpy.context.copy()</span><br><span class="line">            <span class="variable language_">self</span>.context[<span class="string">&#x27;window&#x27;</span>] = window</span><br><span class="line">            <span class="variable language_">self</span>.context[<span class="string">&#x27;screen&#x27;</span>] = screen</span><br><span class="line">            <span class="variable language_">self</span>.context[<span class="string">&#x27;area&#x27;</span>] = area</span><br><span class="line">            <span class="variable language_">self</span>.context[<span class="string">&#x27;region&#x27;</span>] = region</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.context = bpy.context.temp_override(window=window, screen=screen, area=area, region=region)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.legacy:</span><br><span class="line">            <span class="variable language_">self</span>.context.__enter__()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_value, traceback</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.legacy:</span><br><span class="line">            <span class="variable language_">self</span>.context.__exit__(<span class="variable language_">self</span>, exc_type, exc_value, traceback)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContextScriptExecuter</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, area_type, ui_type=<span class="literal">None</span>, script=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.area_type = area_type</span><br><span class="line">        <span class="variable language_">self</span>.ui_type = ui_type <span class="keyword">if</span> ui_type <span class="keyword">else</span> area_type</span><br><span class="line">        <span class="variable language_">self</span>.script = script</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">script_content</span>(<span class="params">self, override</span>):</span><br><span class="line">        <span class="variable language_">self</span>.script(override)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_script</span>(<span class="params">self</span>):</span><br><span class="line">        window = bpy.context.window</span><br><span class="line">        screen = window.screen</span><br><span class="line">        areas = [area <span class="keyword">for</span> area <span class="keyword">in</span> screen.areas <span class="keyword">if</span> area.<span class="built_in">type</span> == <span class="variable language_">self</span>.area_type]</span><br><span class="line">        area = areas[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">len</span>(areas) <span class="keyword">else</span> screen.areas[<span class="number">0</span>]</span><br><span class="line">        prev_ui_type = area.ui_type</span><br><span class="line">        area.ui_type = <span class="variable language_">self</span>.ui_type</span><br><span class="line">        regions = [region <span class="keyword">for</span> region <span class="keyword">in</span> area.regions <span class="keyword">if</span> region.<span class="built_in">type</span> == <span class="string">&#x27;WINDOW&#x27;</span>]</span><br><span class="line">        region = regions[<span class="number">0</span>] <span class="keyword">if</span> <span class="built_in">len</span>(regions) <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">with</span> ContextExecuterOverride(window=window, screen=screen, area=area, region=region) <span class="keyword">as</span> override:</span><br><span class="line">            <span class="variable language_">self</span>.script_content(override)</span><br><span class="line">        area.ui_type = prev_ui_type</span><br></pre></td></tr></table></figure><p>具体context override代码的使用例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bpy.ops.object.empty_image_add()函数例子</span></span><br><span class="line">ContextScriptExecuter(</span><br><span class="line">    area_type=<span class="string">&quot;VIEW_3D&quot;</span>,</span><br><span class="line">    script=<span class="keyword">lambda</span> override: (</span><br><span class="line">        bpy.ops.<span class="built_in">object</span>.empty_image_add(</span><br><span class="line">            override.context, filepath=blueprint_front</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">if</span> override.legacy</span><br><span class="line">        <span class="keyword">else</span> bpy.ops.<span class="built_in">object</span>.empty_image_add(filepath=blueprint_front_path)</span><br><span class="line">    ),</span><br><span class="line">).execute_script()</span><br><span class="line"><span class="comment"># bpy.ops.view3d.view_axis()函数例子</span></span><br><span class="line">ContextScriptExecuter(</span><br><span class="line">    area_type=<span class="string">&quot;VIEW_3D&quot;</span>,</span><br><span class="line">    script=<span class="keyword">lambda</span> override: (</span><br><span class="line">        bpy.ops.view3d.view_axis(override.context, <span class="built_in">type</span>=<span class="string">&quot;FRONT&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> override.legacy</span><br><span class="line">        <span class="keyword">else</span> bpy.ops.view3d.view_axis(<span class="built_in">type</span>=<span class="string">&quot;FRONT&quot;</span>)</span><br><span class="line">    ),</span><br><span class="line">).execute_script()</span><br></pre></td></tr></table></figure><h1 id="参考文献">6 &nbsp&nbsp<a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>[1] 「切换语言」使用手册 - Blender 插件，参考文献小节[EB&#x2F;OL]. <a href="https://mister-kin.github.io/works/software-works/toggle-language/#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">https://mister-kin.github.io/works/software-works/toggle-language/#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE</a>.<br>[2] poll() failed, context incorrect? - Example: bpy.ops.view3d.background_image_add()[EB&#x2F;OL]. <a href="https://blender.stackexchange.com/questions/6101/poll-failed-context-incorrect-example-bpy-ops-view3d-background-image-add">https://blender.stackexchange.com/questions/6101/poll-failed-context-incorrect-example-bpy-ops-view3d-background-image-add</a>.<br>[3] Context override[EB&#x2F;OL]. <a href="https://b3d.interplanety.org/en/context-override/">https://b3d.interplanety.org/en/context-override/</a>.<br>[4] Blender 插件开发 技巧&#x2F;误区&#x2F;指南&#x2F;笔记[EB&#x2F;OL]. <a href="https://blog.csdn.net/qq_36288357/article/details/143528487">https://blog.csdn.net/qq_36288357/article/details/143528487</a>.</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;推荐资源&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#推荐资源&quot; class=&quot;headerlink&quot; title=&quot;推荐资源&quot;&gt;&lt;/a&gt;推荐资源&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a</summary>
        
      
    
    
    
    <category term="software" scheme="https://mister-kin.github.io/categories/software/"/>
    
    <category term="blender" scheme="https://mister-kin.github.io/categories/software/blender/"/>
    
    
  </entry>
  
  <entry>
    <title>Blender实战案例总结</title>
    <link href="https://mister-kin.github.io/software/blender/examples/"/>
    <id>https://mister-kin.github.io/software/blender/examples/</id>
    <published>2024-05-12T12:06:35.000Z</published>
    <updated>2024-12-27T17:41:45.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="精确建模">1 &nbsp&nbsp<a href="#精确建模" class="headerlink" title="精确建模"></a>精确建模</h1><ul><li>N面板可以控制物体尺寸查看，查看当前模型的尺寸。缩放到精确尺寸后，ctrl+a应用变化。</li><li>object mode变换可能会导致系数变化，Ctrl+A可以重置缩放系数，全部归并至系数1（以当前尺寸为基础）<ul><li>（edit mode不会改变物体属性，只是改变物体内部的点线面分布）不推荐在物体模式下进行单轴向缩放，旋转还是会考虑在物体模式</li></ul></li><li>建模后添加细分修改器，右键平滑</li></ul><p>注：系数为负数时，从blender导出资产到UE4会导致模型法线变反还是模型变黑？</p><h1 id="SVG转3D网格">2 &nbsp&nbsp<a href="#SVG转3D网格" class="headerlink" title="SVG转3D网格"></a>SVG转3D网格</h1><ol><li>切换到顶视图-7键。</li><li>菜单&gt;文件&gt;导入&gt;SVG</li><li>缩放视图找到SVG。</li><li>右键set origin，调整“原点”至物体中心。</li><li>shift+s键对齐“原点”至世界中心</li><li>选中并缩放至合适大小。</li><li>右键convert to，转换到Mesh。</li><li>选中网格物体，TAB键进入“编辑模式”。</li><li>A键选中所有网格。</li><li>切换到侧视图-3或1键。（按住Ctrl时为视图反方向）</li><li>E键挤出面。</li><li>TAB键回到“物体模式”。</li></ol><h1 id="灰尘例子动画">3 &nbsp&nbsp<a href="#灰尘例子动画" class="headerlink" title="灰尘例子动画"></a>灰尘例子动画</h1><p>无特殊说明，则都是在粒子标签内操作。</p><ol><li>创建合适的立方体（粒子场）</li><li>选择立方体，属性编辑器&gt;粒子标签&gt;新建粒子系统</li><li>粒子类型&gt;发射体；发射&gt;源&gt;发射源&gt;体积</li><li>创建灰尘物体模型</li><li>渲染&gt;渲染为&gt;物体（此为单个效果，用集合来实现多个），物体&gt;选择灰尘物体模型</li><li>渲染&gt;缩放&gt;数值调整；缩放随机性&gt;1</li><li>1键切换到前视图，ctrl+alt+0并左击相机视角边框处以选中相机，按G调整相机视角；属性编辑器&gt;相机属性&gt;镜头&gt;焦距&gt;数值调整。</li><li>启用旋转功能&gt;坐标系轴向&gt;normal；随机&gt;数值调整；相位&gt;数值调整；随机相位&gt;数值调整</li><li>选中立方体，属性编辑器&gt;材质&gt;表面&gt;移除材质，材质&gt;体积&gt;原理化体积&gt;密度调0.14</li><li>属性编辑器&gt;世界属性&gt;颜色调至黑色（除去环境亮度）</li></ol><h1 id="无限旋转循环">4 &nbsp&nbsp<a href="#无限旋转循环" class="headerlink" title="无限旋转循环"></a>无限旋转循环</h1><p>物体属性&gt;旋转（选一个方向）&gt;输入「#frame&#x2F;30」</p><p># 符号，blender会将其判为驱动器表达式。</p><h1 id="VSE无限循环片段">5 &nbsp&nbsp<a href="#VSE无限循环片段" class="headerlink" title="VSE无限循环片段"></a>VSE无限循环片段</h1><ol><li>shift + D 复制并对齐片段</li><li>shift + R 重操操作</li></ol>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;精确建模&quot;&gt;1 &amp;nbsp&amp;nbsp&lt;a href=&quot;#精确建模&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="software" scheme="https://mister-kin.github.io/categories/software/"/>
    
    <category term="blender" scheme="https://mister-kin.github.io/categories/software/blender/"/>
    
    
  </entry>
  
</feed>
